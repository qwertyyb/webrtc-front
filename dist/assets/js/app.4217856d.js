(function (e) { function t (t) { for (var r, o, u = t[0], i = t[1], s = t[2], f = 0, l = []; f < u.length; f++)o = u[f], c[o] && l.push(c[o][0]), c[o] = 0; for (r in i)Object.prototype.hasOwnProperty.call(i, r) && (e[r] = i[r]); d && d(t); while (l.length)l.shift()(); return a.push.apply(a, s || []), n() } function n () { for (var e, t = 0; t < a.length; t++) { for (var n = a[t], r = !0, o = 1; o < n.length; o++) { var u = n[o]; c[u] !== 0 && (r = !1) }r && (a.splice(t--, 1), e = i(i.s = n[0])) } return e } var r = {}; var o = { app: 0 }; var c = { app: 0 }; var a = []; function u (e) { return i.p + 'assets/js/' + ({ about: 'about' }[e] || e) + '.' + { about: 'd288b4f1', 'chunk-24c7612c': '315db58b', 'chunk-3f7bc161': '3acfd2a8', 'chunk-2d0a2e01': 'ccd320ee', 'chunk-8cebcd9c': '60270277', 'chunk-5af98794': '54d95c01', 'chunk-1db734bf': '2a7c84da', 'chunk-29ff438e': '242804ca', 'chunk-3884c10c': 'fd126ed9', 'chunk-64b87ff6': '202c4b54' }[e] + '.js' } function i (t) { if (r[t]) return r[t].exports; var n = r[t] = { i: t, l: !1, exports: {} }; return e[t].call(n.exports, n, n.exports, i), n.l = !0, n.exports }i.e = function (e) { var t = []; var n = { 'chunk-1db734bf': 1, 'chunk-64b87ff6': 1 }; o[e] ? t.push(o[e]) : o[e] !== 0 && n[e] && t.push(o[e] = new Promise(function (t, n) { for (var r = 'assets/css/' + ({ about: 'about' }[e] || e) + '.' + { about: '31d6cfe0', 'chunk-24c7612c': '31d6cfe0', 'chunk-3f7bc161': '31d6cfe0', 'chunk-2d0a2e01': '31d6cfe0', 'chunk-8cebcd9c': '31d6cfe0', 'chunk-5af98794': '31d6cfe0', 'chunk-1db734bf': '5c4a130e', 'chunk-29ff438e': '31d6cfe0', 'chunk-3884c10c': '31d6cfe0', 'chunk-64b87ff6': '0e433876' }[e] + '.css', c = i.p + r, a = document.getElementsByTagName('link'), u = 0; u < a.length; u++) { var s = a[u]; var f = s.getAttribute('data-href') || s.getAttribute('href'); if (s.rel === 'stylesheet' && (f === r || f === c)) return t() } var l = document.getElementsByTagName('style'); for (u = 0; u < l.length; u++) { s = l[u], f = s.getAttribute('data-href'); if (f === r || f === c) return t() } var d = document.createElement('link'); d.rel = 'stylesheet', d.type = 'text/css', d.onload = t, d.onerror = function (t) { var r = t && t.target && t.target.src || c; var a = new Error('Loading CSS chunk ' + e + ' failed.\n(' + r + ')'); a.request = r, delete o[e], d.parentNode.removeChild(d), n(a) }, d.href = c; var h = document.getElementsByTagName('head')[0]; h.appendChild(d) }).then(function () { o[e] = 0 })); var r = c[e]; if (r !== 0) if (r)t.push(r[2]); else { var a = new Promise(function (t, n) { r = c[e] = [t, n] }); t.push(r[2] = a); var s; var f = document.createElement('script'); f.charset = 'utf-8', f.timeout = 120, i.nc && f.setAttribute('nonce', i.nc), f.src = u(e), s = function (t) { f.onerror = f.onload = null, clearTimeout(l); var n = c[e]; if (n !== 0) { if (n) { var r = t && (t.type === 'load' ? 'missing' : t.type); var o = t && t.target && t.target.src; var a = new Error('Loading chunk ' + e + ' failed.\n(' + r + ': ' + o + ')'); a.type = r, a.request = o, n[1](a) }c[e] = void 0 } }; var l = setTimeout(function () { s({ type: 'timeout', target: f }) }, 12e4); f.onerror = f.onload = s, document.head.appendChild(f) } return Promise.all(t) }, i.m = e, i.c = r, i.d = function (e, t, n) { i.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: n }) }, i.r = function (e) { typeof Symbol !== 'undefined' && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: 'Module' }), Object.defineProperty(e, '__esModule', { value: !0 }) }, i.t = function (e, t) { if (1 & t && (e = i(e)), 8 & t) return e; if (4 & t && typeof e === 'object' && e && e.__esModule) return e; var n = Object.create(null); if (i.r(n), Object.defineProperty(n, 'default', { enumerable: !0, value: e }), 2 & t && typeof e !== 'string') for (var r in e)i.d(n, r, function (t) { return e[t] }.bind(null, r)); return n }, i.n = function (e) { var t = e && e.__esModule ? function () { return e['default'] } : function () { return e }; return i.d(t, 'a', t), t }, i.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, i.p = '', i.oe = function (e) { throw console.error(e), e }; var s = window['webpackJsonp'] = window['webpackJsonp'] || []; var f = s.push.bind(s); s.push = t, s = s.slice(); for (var l = 0; l < s.length; l++)t(s[l]); var d = f; a.push([0, 'chunk-vendors']), n() })({ 0: function (e, t, n) { e.exports = n('56d7') }, '034f': function (e, t, n) { 'use strict'; var r = n('64a9'); var o = n.n(r); o.a }, 1: function (e, t) {}, '365c': function (e, t, n) { 'use strict'; var r = n('cebc'); var o = n('bc3a'); var c = n.n(o); var a = n('323e'); var u = n.n(a); var i = (n('a5d8'), n('5c96')); var s = n('c0d6'); var f = n('41cb'); var l = c.a.create({ baseURL: '/api/v1' }); l.interceptors.request.use(function (e) { return u.a.start(), e.headers = Object(r['a'])({}, e.headers, { token: s['a'].state.token }), e }), l.interceptors.response.use(function (e) { if (u.a.done(), e.data.status === 1) return e.data; if (e.data.status === 403) return f['a'].push('/login'); throw i['Message'].error(e.data.msg || '服务出\b错'), new Error(e.data.msg || '服务出\b错') }); var d = l; n.d(t, 'a', function () { return h }), n.d(t, 'b', function () { return p }), n.d(t, 'c', function () { return m }), n.d(t, 'd', function () { return b }); var h = function (e) { return d.get('presentors', { params: e }) }; var p = function (e) { return d.get('videos', { params: e }) }; var m = function (e) { return d.post('user/login', e) }; var b = function (e) { return d.post('user/register', e) } }, '41cb': function (e, t, n) { 'use strict'; n('7f7f'); var r = n('2b0e'); var o = n('8c4f'); var c = function () { var e = this; var t = e.$createElement; var n = e._self._c || t; return n('div', { staticClass: 'home' }) }; var a = []; var u = { name: 'home' }; var i = u; var s = n('2877'); var f = Object(s['a'])(i, c, a, !1, null, null, null); var l = f.exports; var d = n('c0d6'); r['default'].use(o['a']); var h = new o['a']({ mode: 'history', base: '', routes: [{ path: '/', name: 'home', component: l, redirect: '/videos' }, { path: '/about', name: 'about', component: function () { return n.e('about').then(n.bind(null, 'f820')) } }, { path: '/presentor', name: 'presentor', component: function (e) { return Promise.all([n.e('chunk-5af98794'), n.e('chunk-64b87ff6')]).then(n.bind(null, '30ec')) } }, { path: '/livings', name: 'livings', component: function (e) { return Promise.all([n.e('chunk-3f7bc161'), n.e('chunk-8cebcd9c')]).then(n.bind(null, 'dff6')) } }, { path: '/live/:liveId', name: 'live', component: function (e) { return Promise.all([n.e('chunk-5af98794'), n.e('chunk-1db734bf')]).then(n.bind(null, '1502')) } }, { path: '/videos', name: 'videos', component: function (e) { return Promise.all([n.e('chunk-3f7bc161'), n.e('chunk-2d0a2e01')]).then(n.bind(null, '007b')) } }, { path: '/call', name: 'call', component: function (e) { return Promise.all([n.e('chunk-5af98794'), n.e('chunk-3884c10c')]).then(n.bind(null, '10f1')) } }, { path: '/accept', name: 'acceptcall', component: function (e) { return Promise.all([n.e('chunk-5af98794'), n.e('chunk-29ff438e')]).then(n.bind(null, '40e5')) } }, { path: '/login', name: 'login', component: function (e) { return n.e('chunk-24c7612c').then(n.bind(null, 'dd7b')) } }] }); h.beforeEach(function (e, t, n) { return d['a'].state.token || e.name === 'login' ? d['a'].state.token && e.name === 'login' ? n('/') : void n() : n('/login') }); t['a'] = h }, '56d7': function (e, t, n) { 'use strict'; n.r(t); n('cadf'), n('551c'), n('f751'), n('097d'); var r = n('2b0e'); var o = function () { var e = this; var t = e.$createElement; var n = e._self._c || t; return n('div', { staticClass: 'bg-grey-lighter', attrs: { id: 'app' } }, [n('header', { staticClass: 'flex p-1 items-center justify-between' }, [n('h1', [e._v('WebRTC')]), n('div', { staticClass: 'mr-auto', attrs: { id: 'nav' } }, [n('router-link', { attrs: { to: '/presentor' } }, [e._v('做直播')]), e._v(' |\n      '), n('router-link', { attrs: { to: '/livings' } }, [e._v('看直播')]), e._v(' |\n      '), n('router-link', { attrs: { to: '/videos' } }, [e._v('视频')]), e._v(' |\n      '), n('router-link', { attrs: { to: '/call' } }, [e._v('对话')])], 1), e.userInfo.nickname ? n('div', { staticClass: 'user flex items-center' }, [n('img', { staticClass: 'user-avatar h-12 w-12 rounded-full border', attrs: { src: e.userInfo.avatar || 'https://via.placeholder.com/50', alt: '' } }), n('span', { staticClass: 'mx-2' }, [e._v(e._s(e.userInfo.nickname))]), n('el-button', { attrs: { type: 'text' }, on: { click: e.logout } }, [e._v('退出')])], 1) : e._e()]), n('router-view')], 1) }; var c = []; var a = n('6c23'); var u = { computed: { userInfo: function () { return this.$store.state.userInfo || {} }, token: function () { return this.$store.state.token || '' } }, watch: { token: { immediate: !0, handler: function (e) { e ? Object(a['c'])() : Object(a['d'])() } } }, beforeDestroy: function () { Object(a['d'])() }, methods: { logout: function () { this.$store.commit('clearAuthState'), location.reload() } } }; var i = u; var s = (n('034f'), n('2877')); var f = Object(s['a'])(i, o, c, !1, null, null, null); var l = f.exports; var d = n('41cb'); var h = n('c0d6'); var p = (n('d093'), n('5c96')); var m = n.n(p); n('0fae'); r['default'].config.productionTip = !1, r['default'].use(m.a), new r['default']({ router: d['a'], store: h['a'], render: function (e) { return e(l) } }).$mount('#app') }, '64a9': function (e, t, n) {}, '6c23': function (e, t, n) { 'use strict'; n.d(t, 'c', function () { return d }), n.d(t, 'd', function () { return h }), n.d(t, 'a', function () { return p }), n.d(t, 'b', function () { return m }); var r = n('f499'); var o = n.n(r); var c = n('8055'); var a = n.n(c); var u = n('5c96'); var i = n('c0d6'); var s = n('41cb'); var f = null; var l = function (e) { u['Message'].error(e.message) }; var d = function () { return f = a()({ path: '/socket.io/webrtc', reconnection: !1, query: { token: i['a'].state.token } }), f.on('connect_error', l), f.on('error', l), f.on('call', function (e) { var t = e.from; var n = e.linkId; u['MessageBox'].confirm('你有一通来自'.concat(t.nickname, '的呼叫,是否接听？'), '提醒', { cancelButtonText: '拒绝', confirmButtonText: '接听' }).then(function (e) { s['a'].push({ name: 'acceptcall', query: { inviter: encodeURIComponent(o()(t)), linkId: encodeURIComponent(n) } }) }).catch(function (e) { throw f.emit('rejectcall', { from: t }), e }) }), f.on('autherror', function (e) { console.log('auth error, need relogin'), i['a'].commit('clearAuthState'), s['a'].push('/login?redirectUrl='.concat(encodeURIComponent(s['a'].currentRoute.fullPath))) }), f.emit('online'), f }; var h = function () { f && (f.emit('offline'), f.close(), f = null) }; var p = function (e) { if (f) return f; if (f.state.token) return d(); throw new Error('no token, cant start a socket') }; var m = function (e) { var t = a()({ path: '/socket.io/webrtc', reconnection: !1, query: { token: i['a'].state.token } }); return t.on('connect_error', l), t.on('error', l), t } }, c0d6: function (e, t, n) { 'use strict'; var r = n('f499'); var o = n.n(r); var c = n('cebc'); var a = n('2b0e'); var u = n('2f62'); var i = n('365c'); a['default'].use(u['a']), t['a'] = new u['a'].Store({ state: { token: localStorage.getItem('token') || '', userInfo: JSON.parse(localStorage.getItem('userInfo') || '{}') }, mutations: { updateToken: function (e, t) { e.token = t }, updateUserInfo: function (e, t) { e.userInfo = Object(c['a'])({}, t) }, clearAuthState: function (e) { e.token = '', e.userInfo = {}, localStorage.setItem('token', ''), localStorage.setItem('userInfo', '{}') } }, actions: { login: function (e, t) { var n = e.commit; var r = t.nickname; var c = t.password; return Object(i['c'])({ nickname: r, password: c }).then(function (e) { var t = e.data; return n('updateToken', t.token), n('updateUserInfo', t.user), localStorage.setItem('token', t.token), localStorage.setItem('userInfo', o()(t.user)), t }) } } }) } })
// # sourceMappingURL=app.4217856d.js.map
