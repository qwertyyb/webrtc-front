(window['webpackJsonp'] = window['webpackJsonp'] || []).push([['chunk-1db734bf'], { '0643': function (e, t, n) {}, 1502: function (e, t, n) { 'use strict'; n.r(t); var o = function () { var e = this; var t = e.$createElement; var o = e._self._c || t; return o('div', { staticClass: 'page-live flex justify-center' }, [o('div', { staticClass: 'container-video flex justify-center flex-col items-center bg-black relative' }, [o('video', { ref: 'video', staticClass: 'video w-full m-2', attrs: { src: e.src, autoplay: '', poster: n('b8b5') } }), o('div', { staticClass: 'living-controls-wrapper m-1 pl-2 flex w-full items-center' }, [o('span', { staticClass: 'text-white mr-auto' }, [e._v('状态: ' + e._s(e.statusText))])])]), e._m(0)]) }; var i = [function () { var e = this; var t = e.$createElement; var n = e._self._c || t; return n('div', { staticClass: 'container-message w-64 ml-4 flex flex-col justify-between' }, [n('div', { staticClass: 'wrapper-message' }, [e._v('\n      这是消息内容\n    ')]), n('div', { staticClass: 'wrapper-input' }, [n('input', { staticClass: 'border h-8 rounded', attrs: { type: 'text' } }), n('button', { staticClass: 'bg-blue h-full px-2 text-white hover:bg-blue-light rounded ml-2' }, [e._v('发送')])])]) }]; var s = n('4777'); var a = null; var c = { name: 'page-live', data: function () { return { src: null, status: 'initial' } }, computed: { statusText: function () { var e = { initial: '未开始', starting: '准备中', living: '直播中', ending: '结束中', ended: '已结束' }; return e[this.status] } }, created: function () { var e = this; window.addEventListener('unload', function () { e.stop() }) }, mounted: function () { this.start() }, beforeDestroy: function () { console.log('before destroy'), this.stop() }, methods: { start: function () { var e = this; this.status = 'starting', a = new s['a'](this.$refs.video, this.$route.params.liveId), console.log(a), a.on('start', function () { e.status = 'living' }), a.start() }, stop: function () { a && a.stop(), a = null, this.status = 'initial' } } }; var r = c; var l = (n('c3f5'), n('2877')); var u = Object(l['a'])(r, o, i, !1, null, '1a48cc47', null); t['default'] = u.exports }, 4777: function (e, t, n) { 'use strict'; n('7f7f'); var o = n('a4bb'); var i = n.n(o); var s = (n('6762'), n('2fdb'), n('f499')); var a = n.n(s); var c = n('795b'); var r = n.n(c); var l = n('d225'); var u = n('b0b4'); var d = n('bd86'); var f = n('a825'); var v = n('d519'); var p = n.n(v); var b = n('8055'); var h = n.n(b); var m = n('c0d6'); var g = (function () { function e (t, n) { var o = this; Object(l['a'])(this, e), Object(d['a'])(this, 'socket', null), Object(d['a'])(this, 'videoDom', null), Object(d['a'])(this, 'webRtcPeer', null), Object(d['a'])(this, 'events', { start: [], stop: [], presentorgone: [] }), Object(d['a'])(this, '_onVideoCanplay', function (e) { o.emit('start') }), Object(d['a'])(this, 'bindEvent', function () { var e = o.socket; var t = o.webRtcPeer; e.on('startResponse', function (e) { var n = e.sdpAnswer; console.log('SDP answer received from server. Processing ...'), t.processAnswer(n) }), e.on('iceCandidate', function (e) { var n = e.candidate; console.log('iceCandidate', n), t.addIceCandidate(n) }), e.on('presentorgone', function (e) { o.videoDom.pause(), o.videoDom.srcObject = null, o.videoDom.load(), o.emit('presentorgone'), o.socket.close(), o.emit('stop') }), console.log(t) }), Object(d['a'])(this, 'start', function () { var e = { remoteVideo: o.videoDom, onicecandidate: o.onIceCandidate, configuration: { iceServers: f['a'] } }; return new r.a(function (t, n) { o.webRtcPeer = p.a.WebRtcPeer.WebRtcPeerRecvonly(e, function (e) { if (e) return n(e); t() }) }).then(function (e) { return o.bindEvent(), new r.a(function (e, t) { return o.webRtcPeer.generateOffer(function (n, o) { if (n) return t(n); e(o) }) }) }).then(function (e) { console.info('Invoking SDP offer callback function ' + location.host), o.socket.emit('createViewer', { sdpOffer: e }) }) }), Object(d['a'])(this, 'stop', function () { console.log('Stopping video call ...'), o.webRtcPeer && (o.webRtcPeer.dispose(), console.log('dispose'), o.webRtcPeer = null), o.socket.emit('stop') }), Object(d['a'])(this, 'onIceCandidate', function (e) { console.log('Local candidate' + a()(e)), o.socket.emit('onIceCandidate', { candidate: e }) }), console.log(t), this.socket = h()({ path: '/socket.io/webrtc', query: { token: m['a'].state.token, presentorId: n }, reconnection: !1 }), this.socket.on('error', function (e) { o.emit('error', e) }), this.socket.on('connect_error', function (e) { console.log('error'), o.emit('error', e) }), this.videoDom = t, t.addEventListener('canplay', this._onVideoCanplay) } return Object(u['a'])(e, [{ key: 'emit', value: function (e) { for (var t = arguments.length, n = new Array(t > 1 ? t - 1 : 0), o = 1; o < t; o++)n[o - 1] = arguments[o]; if (i()(this.events).includes(e)) { var s = this.events[e]; return s.map(function (e) { return e.apply(void 0, n) }) } } }, { key: 'on', value: function (e, t) { if (i()(this.events).includes(e)) { var n = this.events[e]; n.includes(t) || n.push(t) } } }]), e }()); t['a'] = g }, c3f5: function (e, t, n) { 'use strict'; var o = n('0643'); var i = n.n(o); i.a } }])
// # sourceMappingURL=chunk-1db734bf.2a7c84da.js.map
