{"version":3,"sources":["webpack:///./src/views/live/index.vue?f297","webpack:///src/views/live/index.vue","webpack:///./src/views/live/index.vue?3f6a","webpack:///./src/views/live/index.vue","webpack:///./src/views/live/viewer.js","webpack:///./src/views/live/index.vue?725d"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","attrs","src","autoplay","poster","__webpack_require__","_v","_s","statusText","_m","staticRenderFns","type","livevue_type_script_lang_js_viewer","livevue_type_script_lang_js_","name","data","status","computed","text","initial","starting","living","ending","ended","created","_this","window","addEventListener","stop","mounted","start","beforeDestroy","console","log","methods","_this2","viewer","$refs","video","$route","params","liveId","on","views_livevue_type_script_lang_js_","component","Object","componentNormalizer","__webpack_exports__","Viewer","videoDom","presentorId","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_6__","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__","presentorgone","_","emit","socket","webRtcPeer","_ref","sdpAnswer","processAnswer","_ref2","candidate","addIceCandidate","pause","srcObject","load","close","options","remoteVideo","onicecandidate","onIceCandidate","configuration","iceServers","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_promise__WEBPACK_IMPORTED_MODULE_5___default","a","resolve","reject","kurentoUtils","WebRtcPeer","WebRtcPeerRecvonly","error","then","bindEvent","generateOffer","sdp","info","location","host","sdpOffer","dispose","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_4___default","io","path","query","token","store","state","reconnection","_onVideoCanplay","_len","arguments","length","args","Array","_key","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_object_keys__WEBPACK_IMPORTED_MODULE_1___default","events","includes","cbs","map","func","apply","cb","push","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_index_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_1a48cc47_lang_less_scoped_true___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_index_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_1a48cc47_lang_less_scoped_true___WEBPACK_IMPORTED_MODULE_0___default","n"],"mappings":"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","file":"assets/js/chunk-1db734bf.2a7c84da.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page-live flex justify-center\"},[_c('div',{staticClass:\"container-video flex justify-center flex-col items-center bg-black relative\"},[_c('video',{ref:\"video\",staticClass:\"video w-full m-2\",attrs:{\"src\":_vm.src,\"autoplay\":\"\",\"poster\":require(\"@/assets/webrtc.png\")}}),_c('div',{staticClass:\"living-controls-wrapper m-1 pl-2 flex w-full items-center\"},[_c('span',{staticClass:\"text-white mr-auto\"},[_vm._v(\"状态: \"+_vm._s(_vm.statusText))])])]),_vm._m(0)])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container-message w-64 ml-4 flex flex-col justify-between\"},[_c('div',{staticClass:\"wrapper-message\"},[_vm._v(\"\\n      这是消息内容\\n    \")]),_c('div',{staticClass:\"wrapper-input\"},[_c('input',{staticClass:\"border h-8 rounded\",attrs:{\"type\":\"text\"}}),_c('button',{staticClass:\"bg-blue h-full px-2 text-white hover:bg-blue-light rounded ml-2\"},[_vm._v(\"发送\")])])])}]\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"page-live flex justify-center\">\n    <div class=\"container-video flex justify-center flex-col items-center bg-black relative\">\n      <video :src=\"src\" class=\"video w-full m-2\" ref=\"video\" autoplay\n        poster=\"@/assets/webrtc.png\"\n      ></video>\n      <div class=\"living-controls-wrapper m-1 pl-2 flex w-full items-center\">\n        <span class=\"text-white mr-auto\">状态: {{statusText}}</span>\n      </div>\n    </div>\n    <div class=\"container-message w-64 ml-4 flex flex-col justify-between\">\n      <div class=\"wrapper-message\">\n        这是消息内容\n      </div>\n      <div class=\"wrapper-input\">\n        <input type=\"text\" class=\"border h-8 rounded\">\n        <button class=\"bg-blue h-full px-2 text-white hover:bg-blue-light rounded ml-2\">发送</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Viewer from './viewer'\n\nlet viewer = null\n\nexport default {\n  name: 'page-live',\n  data () {\n    return {\n      src: null, // 'http://vt1.doubanio.com/201903181816/4191665522bbfd3a842c307fd67f0b25/view/movie/M/402410829.mp4',\n      status: 'initial'\n    }\n  },\n  computed: {\n    statusText () {\n      const text = {\n        initial: '未开始',\n        starting: '准备中',\n        living: '直播中',\n        ending: '结束中',\n        ended: '已结束'\n      }\n      return text[this.status]\n    }\n  },\n  created () {\n    window.addEventListener('unload', () => {\n      this.stop()\n    })\n  },\n  mounted () {\n    this.start()\n  },\n  beforeDestroy () {\n    console.log('before destroy')\n    this.stop()\n  },\n  methods: {\n    start () {\n      this.status = 'starting'\n      viewer = new Viewer(this.$refs.video, this.$route.params.liveId)\n      console.log(viewer)\n      viewer.on('start', () => {\n        this.status = 'living'\n      })\n      viewer.start()\n    },\n    stop () {\n      viewer && viewer.stop()\n      viewer = null\n      this.status = 'initial'\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.page-live {\n  .container-video {\n    // height: 520px;\n    width: 660px;\n    // video.video::-webkit-media-controls {\n    //   position: absolute;\n    //   bottom: 0;\n    //   left: 0;\n    //   right: 0;\n    //   z-index: 5;\n    //   width: 100%;\n    //   height: 100px;\n    // }\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=1a48cc47&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=1a48cc47&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1a48cc47\",\n  null\n  \n)\n\nexport default component.exports","import { iceServers } from '@/config/webrtc'\nimport kurentoUtils from 'kurento-utils'\nimport io from 'socket.io-client'\nimport store from '../../store'\n\nclass Viewer {\n  socket = null\n  videoDom = null\n  webRtcPeer = null\n  events = {\n    start: [],\n    stop: [],\n    presentorgone: []\n  }\n  constructor (videoDom, presentorId) {\n    console.log(videoDom)\n    this.socket = io({\n      path: '/socket.io/webrtc',\n      query: {\n        token: store.state.token,\n        presentorId\n      },\n      reconnection: false\n    })\n    this.socket.on('error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('connect_error', error => {\n      console.log('error')\n      this.emit('error', error)\n    })\n    this.videoDom = videoDom\n    videoDom.addEventListener('canplay', this._onVideoCanplay)\n  }\n  _onVideoCanplay = _ => {\n    this.emit('start')\n  }\n  bindEvent = () => {\n    const { socket, webRtcPeer } = this\n    socket.on('startResponse', ({ sdpAnswer }) => {\n      console.log('SDP answer received from server. Processing ...')\n      webRtcPeer.processAnswer(sdpAnswer)\n    })\n    socket.on('iceCandidate', ({ candidate }) => {\n      console.log('iceCandidate', candidate)\n      webRtcPeer.addIceCandidate(candidate)\n    })\n    socket.on('presentorgone', _ => {\n      this.videoDom.pause()\n      this.videoDom.srcObject = null\n      this.videoDom.load()\n      this.emit('presentorgone')\n      this.socket.close()\n      this.emit('stop')\n    })\n    console.log(webRtcPeer)\n  }\n  start = () => {\n    const options = {\n      remoteVideo: this.videoDom,\n      onicecandidate: this.onIceCandidate,\n      configuration: {\n        iceServers\n      }\n    }\n    return new Promise((resolve, reject) => {\n      this.webRtcPeer = kurentoUtils.WebRtcPeer.WebRtcPeerRecvonly(options, error => {\n        if (error) return reject(error)\n        resolve()\n      })\n    }).then(_ => {\n      this.bindEvent()\n      return new Promise((resolve, reject) => this.webRtcPeer.generateOffer((error, sdp) => {\n        if (error) return reject(error)\n        resolve(sdp)\n      }))\n    }).then(sdp => {\n      console.info('Invoking SDP offer callback function ' + location.host)\n      this.socket.emit('createViewer', {\n        sdpOffer: sdp\n      })\n    })\n  }\n\n  stop = () => {\n    console.log('Stopping video call ...')\n    if (this.webRtcPeer) {\n      this.webRtcPeer.dispose()\n      console.log('dispose')\n      this.webRtcPeer = null\n    }\n    this.socket.emit('stop')\n  }\n\n  onIceCandidate = candidate => {\n    console.log('Local candidate' + JSON.stringify(candidate))\n\n    this.socket.emit('onIceCandidate', { candidate })\n  }\n\n  emit (name, ...args) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    return cbs.map(func => func(...args))\n  }\n  on (name, cb) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    if (cbs.includes(cb)) return\n    cbs.push(cb)\n  }\n}\n\nexport default Viewer\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=1a48cc47&lang=less&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=1a48cc47&lang=less&scoped=true&\""],"sourceRoot":""}