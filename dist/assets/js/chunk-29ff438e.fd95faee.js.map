{"version":3,"sources":["webpack:///./src/views/call/accept.vue?5280","webpack:///src/views/call/accept.vue","webpack:///./src/views/call/accept.vue?54d1","webpack:///./src/views/call/accept.vue","webpack:///./src/views/live/viewer.js","webpack:///./src/views/presentor/presentor.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","type","span","_v","on","click","stopCall","gutter","directives","name","rawName","value","expression","element-loading-text","element-loading-spinner","ref","src","autoplay","poster","__webpack_require__","_s","inviter","nickname","staticRenderFns","acceptvue_type_script_lang_js_presentor","acceptvue_type_script_lang_js_viewer","acceptvue_type_script_lang_js_","data","selfLoading","friendLoading","watch","$route.query","immediate","handler","originEncoded","decodeURIComponent","$route","query","JSON","parse","linkId","acceptCall","created","window","addEventListener","mounted","beforeDestroy","removeEventListener","methods","_this","presentor","$refs","socket","emit","from","viewer","_","start","stop","call_acceptvue_type_script_lang_js_","component","Object","componentNormalizer","__webpack_exports__","Viewer","videoDom","presentorId","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_6__","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__","presentorgone","webRtcPeer","_ref","sdpAnswer","console","log","processAnswer","_ref2","candidate","addIceCandidate","pause","srcObject","load","close","options","remoteVideo","onicecandidate","onIceCandidate","configuration","iceServers","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_promise__WEBPACK_IMPORTED_MODULE_5___default","a","resolve","reject","kurentoUtils","WebRtcPeer","WebRtcPeerRecvonly","error","then","bindEvent","generateOffer","sdp","info","location","host","sdpOffer","dispose","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_4___default","io","path","token","store","state","reconnection","_onVideoCanplay","_len","arguments","length","args","Array","_key","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_object_keys__WEBPACK_IMPORTED_MODULE_1___default","events","includes","cbs","map","func","apply","cb","push","Presentor","localVideo","message","undefined","mediaConstraints","video","width","height","audio","WebRtcPeerSendrecv","invite","getNewSocket"],"mappings":"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","file":"assets/js/chunk-29ff438e.fd95faee.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page-accept mx-8\"},[_c('el-row',{attrs:{\"type\":\"flex\"}},[_c('el-col',{staticClass:\"flex items-center\",attrs:{\"span\":20}},[_c('h1',{staticClass:\"font-bold text-2xl\"},[_vm._v(\"正在通话\")])]),_c('el-col',{attrs:{\"span\":4}},[_c('el-button',{attrs:{\"type\":\"danger\"},on:{\"click\":_vm.stopCall}},[_vm._v(\"挂断\")])],1)],1),_c('el-row',{staticClass:\"mx-4\",attrs:{\"gutter\":20}},[_c('el-col',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.selfLoading),expression:\"selfLoading\"}],attrs:{\"span\":12,\"element-loading-text\":\"正在连接...\",\"element-loading-spinner\":\"el-icon-loading\"}},[_c('video',{ref:\"self-video\",staticClass:\"w-full\",attrs:{\"src\":\"\",\"autoplay\":\"\",\"poster\":require(\"@/assets/webrtc.png\")}}),_c('p',{staticClass:\"text-center\"},[_vm._v(\"我\")])]),_c('el-col',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.friendLoading),expression:\"friendLoading\"}],attrs:{\"span\":12,\"element-loading-text\":\"正在连接...\",\"element-loading-spinner\":\"el-icon-loading\"}},[_c('video',{ref:\"friend-video\",staticClass:\"w-full\",attrs:{\"src\":\"\",\"autoplay\":\"\",\"poster\":require(\"@/assets/webrtc.png\")}}),_c('p',{staticClass:\"text-center\"},[_vm._v(_vm._s(_vm.inviter.nickname))])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"page-accept mx-8\">\n    <el-row type=\"flex\">\n      <el-col :span=\"20\" class=\"flex items-center\">\n        <h1 class=\"font-bold text-2xl\">正在通话</h1>\n      </el-col>\n      <el-col :span=\"4\">\n        <el-button type=\"danger\" @click=\"stopCall\">挂断</el-button>\n      </el-col>\n    </el-row>\n    <el-row class=\"mx-4\" :gutter=\"20\">\n      <el-col :span=\"12\" v-loading=\"selfLoading\" element-loading-text=\"正在连接...\" element-loading-spinner=\"el-icon-loading\">\n        <video src=\"\" autoplay class=\"w-full\" ref=\"self-video\" poster=\"@/assets/webrtc.png\"></video>\n        <p class=\"text-center\">我</p>\n      </el-col>\n      <el-col :span=\"12\" v-loading=\"friendLoading\" element-loading-text=\"正在连接...\" element-loading-spinner=\"el-icon-loading\">\n        <video src=\"\" autoplay class=\"w-full\" ref=\"friend-video\"\n          poster=\"@/assets/webrtc.png\"\n        ></video>\n        <p class=\"text-center\">{{inviter.nickname}}</p>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport Presentor from '../presentor/presentor'\nimport Viewer from '../live/viewer'\n\nlet presentor = null\nlet viewer = null\nexport default {\n  name: 'page-accept',\n  data () {\n    return {\n      inviter: {},\n      selfLoading: false,\n      friendLoading: false\n    }\n  },\n  watch: {\n    '$route.query': {\n      immediate: false,\n      handler () {\n        const originEncoded = decodeURIComponent(this.$route.query.inviter || '')\n        const inviter = originEncoded && JSON.parse(originEncoded)\n        const linkId = decodeURIComponent(this.$route.query.linkId || '')\n        inviter && linkId && this.acceptCall(inviter, linkId)\n      }\n    }\n  },\n  created () {\n    window.addEventListener('unload', this.stopCall)\n    this.stopCall()\n  },\n  mounted () {\n    const originEncoded = decodeURIComponent(this.$route.query.inviter || '')\n    const inviter = originEncoded && JSON.parse(originEncoded)\n    const linkId = decodeURIComponent(this.$route.query.linkId || '')\n    inviter && linkId && this.acceptCall(inviter, linkId)\n  },\n  beforeDestroy () {\n    this.stopCall()\n    window.removeEventListener('unload', this.stopCall)\n  },\n  methods: {\n    acceptCall (inviter, linkId) {\n      this.inviter = inviter\n      this.selfLoading = true\n      this.friendLoading = true\n      presentor = new Presentor(this.$refs['self-video'])\n      presentor.on('start', () => {\n        this.selfLoading = false\n        presentor.socket.emit('acceptcall', { from: inviter })\n        viewer = new Viewer(this.$refs['friend-video'], linkId)\n        viewer.on('start', _ => {\n          this.friendLoading = false\n        })\n        viewer.on('presentorgone', _ => {\n          // 对方挂断\n          this.stopCall()\n        })\n        viewer.start()\n      })\n      presentor.start()\n    },\n    stopCall () {\n      presentor && presentor.stop()\n      viewer && viewer.stop()\n    }\n  }\n}\n</script>\n\n<style>\n\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accept.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accept.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./accept.vue?vue&type=template&id=cd6a3274&\"\nimport script from \"./accept.vue?vue&type=script&lang=js&\"\nexport * from \"./accept.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import { iceServers } from '@/config/webrtc'\nimport kurentoUtils from 'kurento-utils'\nimport io from 'socket.io-client'\nimport store from '../../store'\n\nclass Viewer {\n  socket = null\n  videoDom = null\n  webRtcPeer = null\n  events = {\n    start: [],\n    stop: [],\n    presentorgone: []\n  }\n  constructor (videoDom, presentorId) {\n    console.log(videoDom)\n    this.socket = io({\n      path: '/socket.io/webrtc',\n      query: {\n        token: store.state.token,\n        presentorId\n      },\n      reconnection: false\n    })\n    this.socket.on('error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('connect_error', error => {\n      console.log('error')\n      this.emit('error', error)\n    })\n    this.videoDom = videoDom\n    videoDom.addEventListener('canplay', this._onVideoCanplay)\n  }\n  _onVideoCanplay = _ => {\n    this.emit('start')\n  }\n  bindEvent = () => {\n    const { socket, webRtcPeer } = this\n    socket.on('startResponse', ({ sdpAnswer }) => {\n      console.log('SDP answer received from server. Processing ...')\n      webRtcPeer.processAnswer(sdpAnswer)\n    })\n    socket.on('iceCandidate', ({ candidate }) => {\n      console.log('iceCandidate', candidate)\n      webRtcPeer.addIceCandidate(candidate)\n    })\n    socket.on('presentorgone', _ => {\n      this.videoDom.pause()\n      this.videoDom.srcObject = null\n      this.videoDom.load()\n      this.emit('presentorgone')\n      this.socket.close()\n      this.emit('stop')\n    })\n    console.log(webRtcPeer)\n  }\n  start = () => {\n    const options = {\n      remoteVideo: this.videoDom,\n      onicecandidate: this.onIceCandidate,\n      configuration: {\n        iceServers\n      }\n    }\n    return new Promise((resolve, reject) => {\n      this.webRtcPeer = kurentoUtils.WebRtcPeer.WebRtcPeerRecvonly(options, error => {\n        if (error) return reject(error)\n        resolve()\n      })\n    }).then(_ => {\n      this.bindEvent()\n      return new Promise((resolve, reject) => this.webRtcPeer.generateOffer((error, sdp) => {\n        if (error) return reject(error)\n        resolve(sdp)\n      }))\n    }).then(sdp => {\n      console.info('Invoking SDP offer callback function ' + location.host)\n      this.socket.emit('createViewer', {\n        sdpOffer: sdp\n      })\n    })\n  }\n\n  stop = () => {\n    console.log('Stopping viewer ...')\n    if (this.webRtcPeer) {\n      this.webRtcPeer.dispose()\n      console.log('dispose')\n      this.webRtcPeer = null\n    }\n    this.socket.emit('stopViewer')\n  }\n\n  onIceCandidate = candidate => {\n    console.log('Local candidate' + JSON.stringify(candidate))\n\n    this.socket.emit('onIceCandidate', { candidate })\n  }\n\n  emit (name, ...args) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    return cbs.map(func => func(...args))\n  }\n  on (name, cb) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    if (cbs.includes(cb)) return\n    cbs.push(cb)\n  }\n}\n\nexport default Viewer\n","import { iceServers } from '@/config/webrtc'\nimport kurentoUtils from 'kurento-utils'\nimport { getNewSocket } from '@/socket'\n\nclass Presentor {\n  socket = null\n  localVideo = null\n  webRtcPeer = null\n  events = {\n    start: [],\n    stop: [],\n    error: [],\n    message: []\n  }\n  constructor (localVideo) {\n    this.socket = getNewSocket()\n    console.log(this.socket)\n    this.socket.on('error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('connect_error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('callaccepted', message => {\n      this.emit('callaccepted', message)\n    })\n    this.socket.on('callrejected', message => {\n      this.emit('callrejected', message)\n    })\n    this.socket.on('callerror', error => {\n      this.emit('callerror', error)\n    })\n    this.socket.on('message', message => {\n      this.emit('message', message)\n    })\n    this.localVideo = localVideo\n    localVideo.addEventListener('canplay', this._onVideoCanplay)\n  }\n  _onVideoCanplay = _ => {\n    console.log('onvideocanplay')\n    this.emit('start')\n  }\n  bindEvent = () => {\n    const { socket, webRtcPeer } = this\n    socket.on('startResponse', ({ sdpAnswer }) => {\n      console.log('SDP answer received from server. Processing ...')\n      webRtcPeer.processAnswer(sdpAnswer)\n    })\n    socket.on('iceCandidate', ({ candidate }) => {\n      webRtcPeer.addIceCandidate(candidate)\n    })\n  }\n  start = (nickname = null) => {\n    const options = {\n      // localVideo: this.localVideo,\n      remoteVideo: this.localVideo,\n      mediaConstraints: {\n        video: {\n          width: 640,\n          height: 480\n        },\n        audio: true\n      },\n      onicecandidate: this.onIceCandidate,\n      configuration: {\n        iceServers\n      }\n    }\n    return new Promise((resolve, reject) => {\n      this.webRtcPeer = kurentoUtils.WebRtcPeer.WebRtcPeerSendrecv(options, error => {\n        if (error) return reject(error)\n        resolve()\n      })\n    }).then(_ => {\n      this.bindEvent()\n      return new Promise((resolve, reject) => this.webRtcPeer.generateOffer((error, sdp) => {\n        if (error) return reject(error)\n        resolve(sdp)\n      }))\n    }).then(sdp => {\n      console.info('Invoking SDP offer callback function ' + location.host)\n      this.socket.emit('createPresentor', {\n        sdpOffer: sdp,\n        // 邀请某人对话\n        invite: nickname\n      })\n    })\n  }\n\n  stop = () => {\n    console.log('Stopping video call ...')\n    if (this.webRtcPeer) {\n      this.webRtcPeer.dispose()\n      this.webRtcPeer = null\n    }\n    this.localVideo.removeEventListener('canplay', this._onVideoCanplay)\n    this.socket.emit('stopPresentor')\n    this.socket.close()\n    this.emit('stop')\n  }\n\n  onIceCandidate = candidate => {\n    console.log('Local candidate' + JSON.stringify(candidate))\n\n    this.socket.emit('onIceCandidate', { candidate })\n  }\n\n  emit (name, ...args) {\n    console.log(name, this.events)\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    return cbs.map(func => func(...args))\n  }\n  on (name, cb) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    if (cbs.includes(cb)) return\n    cbs.push(cb)\n    return this\n  }\n}\n\nexport default Presentor\n"],"sourceRoot":""}