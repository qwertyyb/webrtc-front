{"version":3,"sources":["webpack:///./src/views/call/index.vue?eea3","webpack:///src/views/call/index.vue","webpack:///./src/views/call/index.vue?31e5","webpack:///./src/views/call/index.vue","webpack:///./src/views/live/viewer.js","webpack:///./src/views/presentor/presentor.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","type","justify","align","span","_v","size","model","value","friend","callback","$$v","$set","expression","disabled","status","on","click","askACall","_s","stopACall","gutter","hidden","ref","src","id","autoplay","poster","__webpack_require__","nickname","staticRenderFns","callvue_type_script_lang_js_presentor","callvue_type_script_lang_js_viewer","callvue_type_script_lang_js_","name","data","created","window","addEventListener","mounted","console","log","beforeDestroy","removeEventListener","methods","trim","presentor","$refs","onCallerror","start","bindEvents","$message","warning","offEvents","stop","socket","Object","src_socket","once","onCallaccepted","onCallrejected","off","_ref","to","element_ui_common","title","concat","_ref2","_this","linkId","success","message","viewer","_","_ref3","error","views_callvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__","Viewer","videoDom","presentorId","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_6__","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__","presentorgone","emit","webRtcPeer","sdpAnswer","processAnswer","candidate","addIceCandidate","pause","srcObject","load","close","options","remoteVideo","onicecandidate","onIceCandidate","configuration","iceServers","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_promise__WEBPACK_IMPORTED_MODULE_5___default","a","resolve","reject","kurentoUtils","WebRtcPeer","WebRtcPeerRecvonly","then","bindEvent","generateOffer","sdp","info","location","host","sdpOffer","dispose","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_4___default","io","path","query","token","store","state","reconnection","_onVideoCanplay","_len","arguments","length","args","Array","_key","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_object_keys__WEBPACK_IMPORTED_MODULE_1___default","events","includes","cbs","map","func","apply","cb","push","Presentor","localVideo","callaccepted","callrejected","callerror","undefined","mediaConstraints","video","width","height","audio","WebRtcPeerSendrecv","invite","getNewSocket"],"mappings":"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","file":"assets/js/chunk-3884c10c.fd126ed9.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"mx-4\"},[_c('el-row',{attrs:{\"type\":\"flex\",\"justify\":\"center\",\"align\":\"middle\"}},[_c('el-col',{staticClass:\"text-right\",attrs:{\"span\":8}},[_vm._v(\"\\n      请输入对方的用户名：\\n    \")]),_c('el-col',{attrs:{\"span\":8}},[_c('el-input',{attrs:{\"size\":\"small\"},model:{value:(_vm.friend.nickname),callback:function ($$v) {_vm.$set(_vm.friend, \"nickname\", $$v)},expression:\"friend.nickname\"}})],1),_c('el-col',{staticClass:\"ml-2\",attrs:{\"span\":8}},[_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"primary\",\"disabled\":_vm.status!='free'},on:{\"click\":_vm.askACall}},[_vm._v(_vm._s(_vm.status == 'free' ? '开始呼叫' : '正在呼叫...'))]),_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"danger\",\"disabled\":_vm.status=='free'},on:{\"click\":_vm.stopACall}},[_vm._v(\"挂断\")])],1)],1),_c('el-row',{attrs:{\"gutter\":20,\"hidden\":_vm.status === 'free'}},[_c('el-col',{attrs:{\"span\":12}},[_c('video',{ref:\"self-video\",staticClass:\"w-full m-2\",attrs:{\"src\":\"\",\"id\":\"self-video\",\"autoplay\":\"\",\"poster\":require(\"@/assets/webrtc.png\")}}),_c('p',{staticClass:\"text-center\"},[_vm._v(\"我\")])]),_c('el-col',{attrs:{\"span\":12}},[_c('video',{ref:\"friend-video\",staticClass:\"m-2 friend-video\",attrs:{\"src\":\"\",\"autoplay\":\"\",\"poster\":require(\"@/assets/webrtc.png\")}}),_c('p',{staticClass:\"text-center\"},[_vm._v(_vm._s(_vm.friend.nickname))])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"mx-4\">\n    <el-row type=\"flex\" justify=\"center\" align=\"middle\">\n      <el-col :span=\"8\" class=\"text-right\">\n        请输入对方的用户名：\n      </el-col>\n      <el-col :span=\"8\">\n        <el-input size=\"small\" v-model=\"friend.nickname\"></el-input>\n      </el-col>\n      <el-col :span=\"8\" class=\"ml-2\">\n        <el-button size=\"small\" type=\"primary\"\n          @click=\"askACall\" :disabled=\"status!='free'\"\n        >{{status == 'free' ? '开始呼叫' : '正在呼叫...'}}</el-button>\n        <el-button size=\"small\" type=\"danger\" :disabled=\"status=='free'\"\n          @click=\"stopACall\"\n        >挂断</el-button>\n      </el-col>\n    </el-row>\n    <el-row :gutter=\"20\" :hidden=\"status === 'free'\">\n      <el-col :span=\"12\">\n        <video src=\"\" class=\"w-full m-2\" id=\"self-video\" ref=\"self-video\" autoplay\n          poster=\"@/assets/webrtc.png\"\n        ></video>\n        <p class=\"text-center\">我</p>\n      </el-col>\n      <el-col :span=\"12\">\n        <video src=\"\" class=\"m-2 friend-video\" ref=\"friend-video\" autoplay\n          poster=\"@/assets/webrtc.png\"\n        ></video>\n        <p class=\"text-center\">{{friend.nickname}}</p>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport { Notification } from 'element-ui'\nimport Presentor from '../presentor/presentor'\nimport Viewer from '../live/viewer'\nimport { getGlobalSocket } from '@/socket'\n\nlet presentor = null\nlet viewer = null\nexport default {\n  name: 'page-call',\n  data () {\n    return {\n      friend: {\n        nickname: ''\n      },\n      status: 'free'\n    }\n  },\n  created () {\n    window.addEventListener('unload', this.stopACall)\n  },\n  mounted () {\n    console.log(this)\n  },\n  beforeDestroy () {\n    this.stopACall()\n    window.removeEventListener('unload', this.stopACall)\n  },\n  methods: {\n    askACall () {\n      const { nickname } = this.friend\n      if (!nickname || !nickname.trim()) {\n        this.$message.warning('请输入对方用户名')\n        return\n      }\n      this.stopACall()\n      presentor = new Presentor(this.$refs['self-video'])\n      presentor.on('error', this.onCallerror)\n      presentor.start(nickname.trim())\n      this.status = 'calling'\n      this.bindEvents()\n    },\n    stopACall () {\n      this.offEvents()\n      presentor && presentor.stop()\n      viewer && viewer.stop()\n      this.status = 'free'\n    },\n    bindEvents () {\n      const socket = getGlobalSocket()\n      socket.once('callaccepted', this.onCallaccepted)\n      socket.once('callrejected', this.onCallrejected)\n      socket.on('callerror', this.onCallerror)\n    },\n    offEvents () {\n      const socket = getGlobalSocket()\n      socket.off('callaccepted', this.onCallaccepted)\n      socket.off('callrejected', this.onCallrejected)\n      socket.off('callerror', this.onCallerror)\n    },\n    onCallrejected ({ to }) {\n      this.stopACall()\n      this.status = 'free'\n      Notification.warning({\n        title: `呼叫已被${to.nickname}拒绝`\n      })\n    },\n    onCallaccepted ({ to, linkId }) {\n      console.log(`呼叫已被${to.nickname}接听`)\n      Notification.success({\n        title: `呼叫已被${to.nickname}接听`,\n        message: '正在建立连接...'\n      })\n      viewer = new Viewer(this.$refs['friend-video'], linkId)\n      viewer.on('presentorgone', _ => {\n        this.stopACall()\n      })\n      viewer.start()\n    },\n    onCallerror ({ message }) {\n      this.stopACall()\n      Notification.error({\n        title: message\n      })\n      this.status = 'free'\n    }\n  }\n}\n</script>\n\n<style>\n\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=6e1716bd&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import { iceServers } from '@/config/webrtc'\nimport kurentoUtils from 'kurento-utils'\nimport io from 'socket.io-client'\nimport store from '../../store'\n\nclass Viewer {\n  socket = null\n  videoDom = null\n  webRtcPeer = null\n  events = {\n    start: [],\n    stop: [],\n    presentorgone: []\n  }\n  constructor (videoDom, presentorId) {\n    console.log(videoDom)\n    this.socket = io({\n      path: '/socket.io/webrtc',\n      query: {\n        token: store.state.token,\n        presentorId\n      },\n      reconnection: false\n    })\n    this.socket.on('error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('connect_error', error => {\n      console.log('error')\n      this.emit('error', error)\n    })\n    this.videoDom = videoDom\n    videoDom.addEventListener('canplay', this._onVideoCanplay)\n  }\n  _onVideoCanplay = _ => {\n    this.emit('start')\n  }\n  bindEvent = () => {\n    const { socket, webRtcPeer } = this\n    socket.on('startResponse', ({ sdpAnswer }) => {\n      console.log('SDP answer received from server. Processing ...')\n      webRtcPeer.processAnswer(sdpAnswer)\n    })\n    socket.on('iceCandidate', ({ candidate }) => {\n      console.log('iceCandidate', candidate)\n      webRtcPeer.addIceCandidate(candidate)\n    })\n    socket.on('presentorgone', _ => {\n      this.videoDom.pause()\n      this.videoDom.srcObject = null\n      this.videoDom.load()\n      this.emit('presentorgone')\n      this.socket.close()\n      this.emit('stop')\n    })\n    console.log(webRtcPeer)\n  }\n  start = () => {\n    const options = {\n      remoteVideo: this.videoDom,\n      onicecandidate: this.onIceCandidate,\n      configuration: {\n        iceServers\n      }\n    }\n    return new Promise((resolve, reject) => {\n      this.webRtcPeer = kurentoUtils.WebRtcPeer.WebRtcPeerRecvonly(options, error => {\n        if (error) return reject(error)\n        resolve()\n      })\n    }).then(_ => {\n      this.bindEvent()\n      return new Promise((resolve, reject) => this.webRtcPeer.generateOffer((error, sdp) => {\n        if (error) return reject(error)\n        resolve(sdp)\n      }))\n    }).then(sdp => {\n      console.info('Invoking SDP offer callback function ' + location.host)\n      this.socket.emit('createViewer', {\n        sdpOffer: sdp\n      })\n    })\n  }\n\n  stop = () => {\n    console.log('Stopping video call ...')\n    if (this.webRtcPeer) {\n      this.webRtcPeer.dispose()\n      console.log('dispose')\n      this.webRtcPeer = null\n    }\n    this.socket.emit('stop')\n  }\n\n  onIceCandidate = candidate => {\n    console.log('Local candidate' + JSON.stringify(candidate))\n\n    this.socket.emit('onIceCandidate', { candidate })\n  }\n\n  emit (name, ...args) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    return cbs.map(func => func(...args))\n  }\n  on (name, cb) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    if (cbs.includes(cb)) return\n    cbs.push(cb)\n  }\n}\n\nexport default Viewer\n","import { iceServers } from '@/config/webrtc'\nimport kurentoUtils from 'kurento-utils'\nimport { getNewSocket } from '@/socket'\n\nclass Presentor {\n  socket = null\n  localVideo = null\n  webRtcPeer = null\n  events = {\n    start: [],\n    stop: [],\n    error: [],\n    callaccepted: [],\n    callrejected: [],\n    callerror: []\n  }\n  constructor (localVideo) {\n    this.socket = getNewSocket()\n    console.log(this.socket)\n    this.socket.on('error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('connect_error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('callaccepted', message => {\n      this.emit('callaccepted', message)\n    })\n    this.socket.on('callrejected', message => {\n      this.emit('callrejected', message)\n    })\n    this.socket.on('callerror', error => {\n      this.emit('callerror', error)\n    })\n    this.localVideo = localVideo\n    localVideo.addEventListener('canplay', this._onVideoCanplay)\n  }\n  _onVideoCanplay = _ => {\n    console.log('onvideocanplay')\n    this.emit('start')\n  }\n  bindEvent = () => {\n    const { socket, webRtcPeer } = this\n    socket.on('startResponse', ({ sdpAnswer }) => {\n      console.log('SDP answer received from server. Processing ...')\n      webRtcPeer.processAnswer(sdpAnswer)\n    })\n    socket.on('iceCandidate', ({ candidate }) => {\n      webRtcPeer.addIceCandidate(candidate)\n    })\n  }\n  start = (nickname = null) => {\n    const options = {\n      // localVideo: this.localVideo,\n      remoteVideo: this.localVideo,\n      mediaConstraints: {\n        video: {\n          width: 640,\n          height: 480\n        },\n        audio: true\n      },\n      onicecandidate: this.onIceCandidate,\n      configuration: {\n        iceServers\n      }\n    }\n    return new Promise((resolve, reject) => {\n      this.webRtcPeer = kurentoUtils.WebRtcPeer.WebRtcPeerSendrecv(options, error => {\n        if (error) return reject(error)\n        resolve()\n      })\n    }).then(_ => {\n      this.bindEvent()\n      return new Promise((resolve, reject) => this.webRtcPeer.generateOffer((error, sdp) => {\n        if (error) return reject(error)\n        resolve(sdp)\n      }))\n    }).then(sdp => {\n      console.info('Invoking SDP offer callback function ' + location.host)\n      this.socket.emit('createPresentor', {\n        sdpOffer: sdp,\n        // 邀请某人对话\n        invite: nickname\n      })\n      // this.socket.emit('inviteViewer', { nickname })\n    })\n  }\n\n  stop = () => {\n    console.log('Stopping video call ...')\n    if (this.webRtcPeer) {\n      this.webRtcPeer.dispose()\n      this.webRtcPeer = null\n    }\n    this.localVideo.removeEventListener('canplay', this._onVideoCanplay)\n    this.socket.emit('stop')\n    this.socket.close()\n    this.emit('stop')\n  }\n\n  onIceCandidate = candidate => {\n    console.log('Local candidate' + JSON.stringify(candidate))\n\n    this.socket.emit('onIceCandidate', { candidate })\n  }\n\n  emit (name, ...args) {\n    console.log(name, this.events)\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    return cbs.map(func => func(...args))\n  }\n  on (name, cb) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    if (cbs.includes(cb)) return\n    cbs.push(cb)\n    return this\n  }\n}\n\nexport default Presentor\n"],"sourceRoot":""}