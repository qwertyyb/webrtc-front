(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e88c81a"],{2614:function(e,t,n){},"30ec":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"page-live flex justify-center"},[s("div",{staticClass:"container-video flex justify-center flex-col items-center bg-black p-2 relative"},[s("video",{ref:"video",staticClass:"video w-full",attrs:{src:e.src,autoplay:"",poster:n("b8b5")}}),s("div",{staticClass:"living-controls-wrapper mt-2 flex w-full items-center"},[s("span",{staticClass:"text-white mr-auto"},[e._v("状态: "+e._s(e.statusText))]),"initial"==e.status?s("el-button",{attrs:{type:"primary"},on:{click:e.start}},[e._v("开始直播")]):"starting"!=e.status?s("el-button",{staticClass:"ml-3",attrs:{type:"danger"},on:{click:e.stop}},[e._v("停止直播")]):e._e()],1)]),s("div",{staticClass:"container-message w-64 rounded ml-4 flex flex-col justify-between bg-gray-200"},[s("div",{staticClass:"wrapper-messages bg-gray-100 border p-2 overflow-y-auto"},[e._l(e.messages,function(t){return["viewer-entry"==t.type?s("div",{key:t.id,staticClass:"message-ite flex justify-center py-1 items-center mb-2 text-sm bg-gray-500 text-center rounded-full"},[s("span",[e._v(e._s(t.time))]),s("img",{staticClass:"w-6 mx-1 rounded-full",attrs:{src:t.from.avatar,alt:""}}),s("span",{staticClass:"font-bold mr-1 text-blue-600"},[e._v(e._s(t.from.nickname))]),e._m(0,!0)]):e._e(),"viewer-leave"==t.type?s("div",{key:t.id,staticClass:"message-ite flex justify-center py-1 items-center mb-2 text-sm bg-red-600 text-center rounded-full"},[s("span",[e._v(e._s(t.time))]),s("img",{staticClass:"w-6 mx-1 rounded-full",attrs:{src:t.from.avatar,alt:""}}),s("span",{staticClass:"font-bold mr-1 text-blue-900"},[e._v(e._s(t.from.nickname))]),e._m(1,!0)]):e._e()]})],2),e._e()])])},i=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v("已 "),n("b",[e._v("进入")]),e._v(" 直播间")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v("已 "),n("b",[e._v("离开")]),e._v(" 直播间")])}],o=n("d5db"),a=null,r={name:"page-presentor",data:function(){return{src:null,status:"initial",messages:[]}},computed:{statusText:function(){var e={initial:"未开始",starting:"准备中",living:"直播中",ending:"结束中",ended:"已结束"};return e[this.status]}},created:function(){var e=this;window.addEventListener("unload",function(){e.stop()})},beforeDestroy:function(){console.log("before destroy"),this.stop()},methods:{start:function(){var e=this;this.status="starting",a=new o["a"](this.$refs.video),console.log(a),a.on("start",function(){e.status="living"}),a.on("error",function(t){console.log(t),e.stop()}),a.on("message",function(t){console.log("received message:",t),e.messages.push(t)}),a.start()},stop:function(){a&&a.stop(),a=null,this.status="initial"}}},c=r,l=(n("d2ef"),n("2877")),u=Object(l["a"])(c,s,i,!1,null,"d0b1b6f2",null);t["default"]=u.exports},d2ef:function(e,t,n){"use strict";var s=n("2614"),i=n.n(s);i.a},d5db:function(e,t,n){"use strict";n("7f7f");var s=n("a4bb"),i=n.n(s),o=(n("6762"),n("2fdb"),n("f499")),a=n.n(o),r=n("795b"),c=n.n(r),l=n("d225"),u=n("b0b4"),d=n("bd86"),f=n("a825"),v=n("d519"),m=n.n(v),p=n("6c23"),b=function(){function e(t){var n=this;Object(l["a"])(this,e),Object(d["a"])(this,"socket",null),Object(d["a"])(this,"localVideo",null),Object(d["a"])(this,"webRtcPeer",null),Object(d["a"])(this,"events",{start:[],stop:[],error:[],message:[]}),Object(d["a"])(this,"_onVideoCanplay",function(e){console.log("onvideocanplay"),n.emit("start")}),Object(d["a"])(this,"bindEvent",function(){var e=n.socket,t=n.webRtcPeer;e.on("startResponse",function(e){var n=e.sdpAnswer;console.log("SDP answer received from server. Processing ..."),t.processAnswer(n)}),e.on("iceCandidate",function(e){var n=e.candidate;t.addIceCandidate(n)})}),Object(d["a"])(this,"start",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={remoteVideo:n.localVideo,mediaConstraints:{video:{width:640,height:480},audio:!0},onicecandidate:n.onIceCandidate,configuration:{iceServers:f["a"]}};return new c.a(function(e,s){n.webRtcPeer=m.a.WebRtcPeer.WebRtcPeerSendrecv(t,function(t){if(t)return s(t);e()})}).then(function(e){return n.bindEvent(),new c.a(function(e,t){return n.webRtcPeer.generateOffer(function(n,s){if(n)return t(n);e(s)})})}).then(function(t){console.info("Invoking SDP offer callback function "+location.host),n.socket.emit("createPresentor",{sdpOffer:t,invite:e})})}),Object(d["a"])(this,"stop",function(){console.log("Stopping video call ..."),n.webRtcPeer&&(n.webRtcPeer.dispose(),n.webRtcPeer=null),n.localVideo.removeEventListener("canplay",n._onVideoCanplay),n.socket.emit("stopPresentor"),n.socket.close(),n.emit("stop")}),Object(d["a"])(this,"onIceCandidate",function(e){console.log("Local candidate"+a()(e)),n.socket.emit("onIceCandidate",{candidate:e})}),this.socket=Object(p["b"])(),console.log(this.socket),this.socket.on("error",function(e){n.emit("error",e)}),this.socket.on("connect_error",function(e){n.emit("error",e)}),this.socket.on("callaccepted",function(e){n.emit("callaccepted",e)}),this.socket.on("callrejected",function(e){n.emit("callrejected",e)}),this.socket.on("callerror",function(e){n.emit("callerror",e)}),this.socket.on("message",function(e){n.emit("message",e)}),this.localVideo=t,t.addEventListener("canplay",this._onVideoCanplay)}return Object(u["a"])(e,[{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];if(console.log(e,this.events),i()(this.events).includes(e)){var o=this.events[e];return o.map(function(e){return e.apply(void 0,n)})}}},{key:"on",value:function(e,t){if(i()(this.events).includes(e)){var n=this.events[e];if(!n.includes(t))return n.push(t),this}}}]),e}();t["a"]=b}}]);
//# sourceMappingURL=chunk-3e88c81a.e38253cf.js.map