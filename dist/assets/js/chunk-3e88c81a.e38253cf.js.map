{"version":3,"sources":["webpack:///./src/views/presentor/index.vue?b3e4","webpack:///src/views/presentor/index.vue","webpack:///./src/views/presentor/index.vue?2a52","webpack:///./src/views/presentor/index.vue","webpack:///./src/views/presentor/index.vue?4b35","webpack:///./src/views/presentor/presentor.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","attrs","src","autoplay","poster","__webpack_require__","_v","_s","statusText","status","type","on","click","start","stop","_e","_l","message","key","id","time","from","avatar","alt","nickname","_m","staticRenderFns","presentorvue_type_script_lang_js_presentor","presentorvue_type_script_lang_js_","name","data","messages","computed","text","initial","starting","living","ending","ended","created","_this","window","addEventListener","beforeDestroy","console","log","methods","_this2","presentor","$refs","video","error","push","views_presentorvue_type_script_lang_js_","component","Object","componentNormalizer","__webpack_exports__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_index_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_d0b1b6f2_lang_less_scoped_true___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_index_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_d0b1b6f2_lang_less_scoped_true___WEBPACK_IMPORTED_MODULE_0___default","n","Presentor","localVideo","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_6__","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__","_","emit","socket","webRtcPeer","_ref","sdpAnswer","processAnswer","_ref2","candidate","addIceCandidate","arguments","length","undefined","options","remoteVideo","mediaConstraints","width","height","audio","onicecandidate","onIceCandidate","configuration","iceServers","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_promise__WEBPACK_IMPORTED_MODULE_5___default","a","resolve","reject","kurentoUtils","WebRtcPeer","WebRtcPeerSendrecv","then","bindEvent","generateOffer","sdp","info","location","host","sdpOffer","invite","dispose","removeEventListener","_onVideoCanplay","close","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_4___default","getNewSocket","_len","args","Array","_key","events","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_object_keys__WEBPACK_IMPORTED_MODULE_1___default","includes","cbs","map","func","apply","cb"],"mappings":"gJAAA,IAAAA,EAAA,WAA0B,IAAAC,EAAAC,KAAaC,EAAAF,EAAAG,eAA0BC,EAAAJ,EAAAK,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iCAA4C,CAAAF,EAAA,OAAYE,YAAA,mFAA8F,CAAAF,EAAA,SAAcG,IAAA,QAAAD,YAAA,eAAAE,MAAA,CAA8CC,IAAAT,EAAAS,IAAAC,SAAA,GAAAC,OAAqCC,EAAQ,WAAwBR,EAAA,OAAYE,YAAA,yDAAoE,CAAAF,EAAA,QAAaE,YAAA,sBAAiC,CAAAN,EAAAa,GAAA,OAAAb,EAAAc,GAAAd,EAAAe,eAAA,WAAAf,EAAAgB,OAAAZ,EAAA,aAAkFI,MAAA,CAAOS,KAAA,WAAiBC,GAAA,CAAKC,MAAAnB,EAAAoB,QAAmB,CAAApB,EAAAa,GAAA,sBAAAb,EAAAgB,OAAAZ,EAAA,aAA4DE,YAAA,OAAAE,MAAA,CAA0BS,KAAA,UAAgBC,GAAA,CAAKC,MAAAnB,EAAAqB,OAAkB,CAAArB,EAAAa,GAAA,UAAAb,EAAAsB,MAAA,KAAAlB,EAAA,OAA4CE,YAAA,iFAA4F,CAAAF,EAAA,OAAYE,YAAA,2DAAsE,CAAAN,EAAAuB,GAAAvB,EAAA,kBAAAwB,GAA0C,uBAAAA,EAAAP,KAAAb,EAAA,OAAmDqB,IAAAD,EAAAE,GAAApB,YAAA,uGAAiI,CAAAF,EAAA,QAAAJ,EAAAa,GAAAb,EAAAc,GAAAU,EAAAG,SAAAvB,EAAA,OAAsDE,YAAA,wBAAAE,MAAA,CAA2CC,IAAAe,EAAAI,KAAAC,OAAAC,IAAA,MAAoC1B,EAAA,QAAaE,YAAA,gCAA2C,CAAAN,EAAAa,GAAAb,EAAAc,GAAAU,EAAAI,KAAAG,aAAA/B,EAAAgC,GAAA,QAAAhC,EAAAsB,KAAA,gBAAAE,EAAAP,KAAAb,EAAA,OAA+GqB,IAAAD,EAAAE,GAAApB,YAAA,sGAAgI,CAAAF,EAAA,QAAAJ,EAAAa,GAAAb,EAAAc,GAAAU,EAAAG,SAAAvB,EAAA,OAAsDE,YAAA,wBAAAE,MAAA,CAA2CC,IAAAe,EAAAI,KAAAC,OAAAC,IAAA,MAAoC1B,EAAA,QAAaE,YAAA,gCAA2C,CAAAN,EAAAa,GAAAb,EAAAc,GAAAU,EAAAI,KAAAG,aAAA/B,EAAAgC,GAAA,QAAAhC,EAAAsB,SAAqE,GAAwPtB,EAAAsB,UAC5lEW,EAAA,YAAoC,IAAAjC,EAAAC,KAAaC,EAAAF,EAAAG,eAA0BC,EAAAJ,EAAAK,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,QAAAJ,EAAAa,GAAA,MAAAT,EAAA,KAAAJ,EAAAa,GAAA,QAAAb,EAAAa,GAAA,WAAuE,WAAc,IAAAb,EAAAC,KAAaC,EAAAF,EAAAG,eAA0BC,EAAAJ,EAAAK,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,QAAAJ,EAAAa,GAAA,MAAAT,EAAA,KAAAJ,EAAAa,GAAA,QAAAb,EAAAa,GAAA,wBCyCvPqB,EAAA,KAEAC,EAAA,CACAC,KAAA,iBACAC,KAFA,WAGA,OACA5B,IAAA,KACAO,OAAA,UACAsB,SAAA,KAcAC,SAAA,CACAxB,WADA,WAEA,IAAAyB,EAAA,CACAC,QAAA,MACAC,SAAA,MACAC,OAAA,MACAC,OAAA,MACAC,MAAA,OAEA,OAAAL,EAAAvC,KAAAe,UAGA8B,QAhCA,WAgCA,IAAAC,EAAA9C,KACA+C,OAAAC,iBAAA,oBACAF,EAAA1B,UAGA6B,cArCA,WAsCAC,QAAAC,IAAA,kBACAnD,KAAAoB,QAEAgC,QAAA,CACAjC,MADA,WACA,IAAAkC,EAAArD,KACAA,KAAAe,OAAA,WACAkB,EAAA,IAAAqB,EAAA,KAAAtD,KAAAuD,MAAAC,OACAN,QAAAC,IAAAlB,GACAA,EAAAhB,GAAA,mBACAoC,EAAAtC,OAAA,WAEAkB,EAAAhB,GAAA,iBAAAwC,GACAP,QAAAC,IAAAM,GACAJ,EAAAjC,SAEAa,EAAAhB,GAAA,mBAAAM,GACA2B,QAAAC,IAAA,oBAAA5B,GACA8B,EAAAhB,SAAAqB,KAAAnC,KAEAU,EAAAd,SAEAC,KAlBA,WAmBAa,KAAAb,OACAa,EAAA,KACAjC,KAAAe,OAAA,aC1G8V4C,EAAA,0BCQ9VC,EAAgBC,OAAAC,EAAA,KAAAD,CACdF,EACA7D,EACAkC,GACF,EACA,KACA,WACA,MAIe+B,EAAA,WAAAH,6CCnBf,IAAAI,EAAArD,EAAA,QAAAsD,EAAAtD,EAAAuD,EAAAF,GAAwjBC,EAAG,yNCIrjBE,aAUJ,SAAAA,EAAaC,GAAY,IAAAtB,EAAA9C,KAAA6D,OAAAQ,EAAA,KAAAR,CAAA7D,KAAAmE,GAAAN,OAAAS,EAAA,KAAAT,CAAA7D,KAAA,SAThB,MASgB6D,OAAAS,EAAA,KAAAT,CAAA7D,KAAA,aARZ,MAQY6D,OAAAS,EAAA,KAAAT,CAAA7D,KAAA,aAPZ,MAOY6D,OAAAS,EAAA,KAAAT,CAAA7D,KAAA,SANhB,CACPmB,MAAO,GACPC,KAAM,GACNqC,MAAO,GACPlC,QAAS,KAEcsC,OAAAS,EAAA,KAAAT,CAAA7D,KAAA,kBAwBP,SAAAuE,GAChBrB,QAAQC,IAAI,kBACZL,EAAK0B,KAAK,WA1BaX,OAAAS,EAAA,KAAAT,CAAA7D,KAAA,YA4Bb,WAAM,IACRyE,EAAuB3B,EAAvB2B,OAAQC,EAAe5B,EAAf4B,WAChBD,EAAOxD,GAAG,gBAAiB,SAAA0D,GAAmB,IAAhBC,EAAgBD,EAAhBC,UAC5B1B,QAAQC,IAAI,mDACZuB,EAAWG,cAAcD,KAE3BH,EAAOxD,GAAG,eAAgB,SAAA6D,GAAmB,IAAhBC,EAAgBD,EAAhBC,UAC3BL,EAAWM,gBAAgBD,OAnCNlB,OAAAS,EAAA,KAAAT,CAAA7D,KAAA,QAsCjB,WAAqB,IAApB8B,EAAoBmD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAT,KACZG,EAAU,CAEdC,YAAavC,EAAKsB,WAClBkB,iBAAkB,CAChB9B,MAAO,CACL+B,MAAO,IACPC,OAAQ,KAEVC,OAAO,GAETC,eAAgB5C,EAAK6C,eACrBC,cAAe,CACbC,oBAGJ,OAAO,IAAIC,EAAAC,EAAQ,SAACC,EAASC,GAC3BnD,EAAK4B,WAAawB,IAAaC,WAAWC,mBAAmBhB,EAAS,SAAA3B,GACpE,GAAIA,EAAO,OAAOwC,EAAOxC,GACzBuC,QAEDK,KAAK,SAAA9B,GAEN,OADAzB,EAAKwD,YACE,IAAIR,EAAAC,EAAQ,SAACC,EAASC,GAAV,OAAqBnD,EAAK4B,WAAW6B,cAAc,SAAC9C,EAAO+C,GAC5E,GAAI/C,EAAO,OAAOwC,EAAOxC,GACzBuC,EAAQQ,SAETH,KAAK,SAAAG,GACNtD,QAAQuD,KAAK,wCAA0CC,SAASC,MAChE7D,EAAK2B,OAAOD,KAAK,kBAAmB,CAClCoC,SAAUJ,EAEVK,OAAQ/E,QAtEW+B,OAAAS,EAAA,KAAAT,CAAA7D,KAAA,OA2ElB,WACLkD,QAAQC,IAAI,2BACRL,EAAK4B,aACP5B,EAAK4B,WAAWoC,UAChBhE,EAAK4B,WAAa,MAEpB5B,EAAKsB,WAAW2C,oBAAoB,UAAWjE,EAAKkE,iBACpDlE,EAAK2B,OAAOD,KAAK,iBACjB1B,EAAK2B,OAAOwC,QACZnE,EAAK0B,KAAK,UApFaX,OAAAS,EAAA,KAAAT,CAAA7D,KAAA,iBAuFR,SAAA+E,GACf7B,QAAQC,IAAI,kBAAoB+D,IAAenC,IAE/CjC,EAAK2B,OAAOD,KAAK,iBAAkB,CAAEO,gBAzFrC/E,KAAKyE,OAAS0C,iBACdjE,QAAQC,IAAInD,KAAKyE,QACjBzE,KAAKyE,OAAOxD,GAAG,QAAS,SAAAwC,GACtBX,EAAK0B,KAAK,QAASf,KAErBzD,KAAKyE,OAAOxD,GAAG,gBAAiB,SAAAwC,GAC9BX,EAAK0B,KAAK,QAASf,KAErBzD,KAAKyE,OAAOxD,GAAG,eAAgB,SAAAM,GAC7BuB,EAAK0B,KAAK,eAAgBjD,KAE5BvB,KAAKyE,OAAOxD,GAAG,eAAgB,SAAAM,GAC7BuB,EAAK0B,KAAK,eAAgBjD,KAE5BvB,KAAKyE,OAAOxD,GAAG,YAAa,SAAAwC,GAC1BX,EAAK0B,KAAK,YAAaf,KAEzBzD,KAAKyE,OAAOxD,GAAG,UAAW,SAAAM,GACxBuB,EAAK0B,KAAK,UAAWjD,KAEvBvB,KAAKoE,WAAaA,EAClBA,EAAWpB,iBAAiB,UAAWhD,KAAKgH,qEAuExC7E,GAAe,QAAAiF,EAAAnC,UAAAC,OAANmC,EAAM,IAAAC,MAAAF,EAAA,EAAAA,EAAA,KAAAG,EAAA,EAAAA,EAAAH,EAAAG,IAANF,EAAME,EAAA,GAAAtC,UAAAsC,GAEnB,GADArE,QAAQC,IAAIhB,EAAMnC,KAAKwH,QAClBC,IAAYzH,KAAKwH,QAAQE,SAASvF,GAAvC,CACA,IAAMwF,EAAM3H,KAAKwH,OAAOrF,GACxB,OAAOwF,EAAIC,IAAI,SAAAC,GAAI,OAAIA,EAAIC,WAAJ,EAAQT,iCAE7BlF,EAAM4F,GACR,GAAKN,IAAYzH,KAAKwH,QAAQE,SAASvF,GAAvC,CACA,IAAMwF,EAAM3H,KAAKwH,OAAOrF,GACxB,IAAIwF,EAAID,SAASK,GAEjB,OADAJ,EAAIjE,KAAKqE,GACF/H,eAIImE","file":"assets/js/chunk-3e88c81a.e38253cf.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page-live flex justify-center\"},[_c('div',{staticClass:\"container-video flex justify-center flex-col items-center bg-black p-2 relative\"},[_c('video',{ref:\"video\",staticClass:\"video w-full\",attrs:{\"src\":_vm.src,\"autoplay\":\"\",\"poster\":require(\"@/assets/webrtc.png\")}}),_c('div',{staticClass:\"living-controls-wrapper mt-2 flex w-full items-center\"},[_c('span',{staticClass:\"text-white mr-auto\"},[_vm._v(\"状态: \"+_vm._s(_vm.statusText))]),(_vm.status=='initial')?_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.start}},[_vm._v(\"开始直播\")]):(_vm.status!='starting')?_c('el-button',{staticClass:\"ml-3\",attrs:{\"type\":\"danger\"},on:{\"click\":_vm.stop}},[_vm._v(\"停止直播\")]):_vm._e()],1)]),_c('div',{staticClass:\"container-message w-64 rounded ml-4 flex flex-col justify-between bg-gray-200\"},[_c('div',{staticClass:\"wrapper-messages bg-gray-100 border p-2 overflow-y-auto\"},[_vm._l((_vm.messages),function(message){return [(message.type == 'viewer-entry')?_c('div',{key:message.id,staticClass:\"message-ite flex justify-center py-1 items-center mb-2 text-sm bg-gray-500 text-center rounded-full\"},[_c('span',[_vm._v(_vm._s(message.time))]),_c('img',{staticClass:\"w-6 mx-1 rounded-full\",attrs:{\"src\":message.from.avatar,\"alt\":\"\"}}),_c('span',{staticClass:\"font-bold mr-1 text-blue-600\"},[_vm._v(_vm._s(message.from.nickname))]),_vm._m(0,true)]):_vm._e(),(message.type == 'viewer-leave')?_c('div',{key:message.id,staticClass:\"message-ite flex justify-center py-1 items-center mb-2 text-sm bg-red-600 text-center rounded-full\"},[_c('span',[_vm._v(_vm._s(message.time))]),_c('img',{staticClass:\"w-6 mx-1 rounded-full\",attrs:{\"src\":message.from.avatar,\"alt\":\"\"}}),_c('span',{staticClass:\"font-bold mr-1 text-blue-900\"},[_vm._v(_vm._s(message.from.nickname))]),_vm._m(1,true)]):_vm._e()]})],2),(false)?_c('div',{staticClass:\"wrapper-input mx-auto p-2\"},[_c('input',{staticClass:\"border h-8 rounded\",attrs:{\"type\":\"text\"}}),_c('button',{staticClass:\"bg-blue-600 h-full px-2 text-white hover:bg-blue-light rounded ml-2\"},[_vm._v(\"发送\")])]):_vm._e()])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',[_vm._v(\"已 \"),_c('b',[_vm._v(\"进入\")]),_vm._v(\" 直播间\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',[_vm._v(\"已 \"),_c('b',[_vm._v(\"离开\")]),_vm._v(\" 直播间\")])}]\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"page-live flex justify-center\">\n    <div class=\"container-video flex justify-center flex-col items-center bg-black p-2 relative\">\n      <video :src=\"src\" class=\"video w-full\" ref=\"video\" autoplay\n        poster=\"@/assets/webrtc.png\"\n      ></video>\n      <div class=\"living-controls-wrapper mt-2 flex w-full items-center\">\n        <span class=\"text-white mr-auto\">状态: {{statusText}}</span>\n        <el-button type=\"primary\" @click=\"start\" v-if=\"status=='initial'\">开始直播</el-button>\n        <el-button type=\"danger\" class=\"ml-3\" @click=\"stop\" v-else-if=\"status!='starting'\">停止直播</el-button>\n      </div>\n    </div>\n    <div class=\"container-message w-64 rounded ml-4 flex flex-col justify-between bg-gray-200\">\n      <div class=\"wrapper-messages bg-gray-100 border p-2 overflow-y-auto\">\n        <template v-for=\"message in messages\">\n          <div class=\"message-ite flex justify-center py-1 items-center mb-2 text-sm bg-gray-500 text-center rounded-full\"\n            :key=\"message.id\" v-if=\"message.type == 'viewer-entry'\">\n            <span>{{message.time}}</span>\n            <img :src=\"message.from.avatar\" alt=\"\" class=\"w-6 mx-1 rounded-full\">\n            <span class=\"font-bold mr-1 text-blue-600\">{{message.from.nickname}}</span>\n            <span>已 <b>进入</b> 直播间</span>\n          </div>\n          <div class=\"message-ite flex justify-center py-1 items-center mb-2 text-sm bg-red-600 text-center rounded-full\"\n            :key=\"message.id\" v-if=\"message.type == 'viewer-leave'\">\n            <span>{{message.time}}</span>\n            <img :src=\"message.from.avatar\" alt=\"\" class=\"w-6 mx-1 rounded-full\">\n            <span class=\"font-bold mr-1 text-blue-900\">{{message.from.nickname}}</span>\n            <span>已 <b>离开</b> 直播间</span>\n          </div>\n        </template>\n      </div>\n      <div class=\"wrapper-input mx-auto p-2\" v-if=\"false\">\n        <input type=\"text\" class=\"border h-8 rounded\">\n        <button class=\"bg-blue-600 h-full px-2 text-white hover:bg-blue-light rounded ml-2\">发送</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Presentor from './presentor'\n\nlet presentor = null\n\nexport default {\n  name: 'page-presentor',\n  data () {\n    return {\n      src: null, // 'http://vt1.doubanio.com/201903181816/4191665522bbfd3a842c307fd67f0b25/view/movie/M/402410829.mp4',\n      status: 'initial',\n      messages: [\n        // {\n        //   type: 'viewer-entry',\n        //   from: { nickname: '虚幻', avatar: 'https://via.placeholder.com/150' },\n        //   time: '12:12:12'\n        // },\n        // {\n        //   type: 'viewer-leave',\n        //   from: { nickname: '虚幻', avatar: 'https://via.placeholder.com/150' },\n        //   time: '12:12:12'\n        // }\n      ]\n    }\n  },\n  computed: {\n    statusText () {\n      const text = {\n        initial: '未开始',\n        starting: '准备中',\n        living: '直播中',\n        ending: '结束中',\n        ended: '已结束'\n      }\n      return text[this.status]\n    }\n  },\n  created () {\n    window.addEventListener('unload', () => {\n      this.stop()\n    })\n  },\n  beforeDestroy () {\n    console.log('before destroy')\n    this.stop()\n  },\n  methods: {\n    start () {\n      this.status = 'starting'\n      presentor = new Presentor(this.$refs.video)\n      console.log(presentor)\n      presentor.on('start', () => {\n        this.status = 'living'\n      })\n      presentor.on('error', error => {\n        console.log(error)\n        this.stop()\n      })\n      presentor.on('message', message => {\n        console.log('received message:', message)\n        this.messages.push(message)\n      })\n      presentor.start()\n    },\n    stop () {\n      presentor && presentor.stop()\n      presentor = null\n      this.status = 'initial'\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.page-live {\n  height: 540px;\n  max-height: 540px;\n  .wrapper-messages {\n    height: 500px;\n  }\n  .container-video {\n    // height: 540px;\n    // width: 660px;\n    // video.video::-webkit-media-controls {\n    //   position: absolute;\n    //   bottom: 0;\n    //   left: 0;\n    //   right: 0;\n    //   z-index: 5;\n    //   width: 100%;\n    //   height: 100px;\n    // }\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=d0b1b6f2&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=d0b1b6f2&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"d0b1b6f2\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=d0b1b6f2&lang=less&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=d0b1b6f2&lang=less&scoped=true&\"","import { iceServers } from '@/config/webrtc'\nimport kurentoUtils from 'kurento-utils'\nimport { getNewSocket } from '@/socket'\n\nclass Presentor {\n  socket = null\n  localVideo = null\n  webRtcPeer = null\n  events = {\n    start: [],\n    stop: [],\n    error: [],\n    message: []\n  }\n  constructor (localVideo) {\n    this.socket = getNewSocket()\n    console.log(this.socket)\n    this.socket.on('error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('connect_error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('callaccepted', message => {\n      this.emit('callaccepted', message)\n    })\n    this.socket.on('callrejected', message => {\n      this.emit('callrejected', message)\n    })\n    this.socket.on('callerror', error => {\n      this.emit('callerror', error)\n    })\n    this.socket.on('message', message => {\n      this.emit('message', message)\n    })\n    this.localVideo = localVideo\n    localVideo.addEventListener('canplay', this._onVideoCanplay)\n  }\n  _onVideoCanplay = _ => {\n    console.log('onvideocanplay')\n    this.emit('start')\n  }\n  bindEvent = () => {\n    const { socket, webRtcPeer } = this\n    socket.on('startResponse', ({ sdpAnswer }) => {\n      console.log('SDP answer received from server. Processing ...')\n      webRtcPeer.processAnswer(sdpAnswer)\n    })\n    socket.on('iceCandidate', ({ candidate }) => {\n      webRtcPeer.addIceCandidate(candidate)\n    })\n  }\n  start = (nickname = null) => {\n    const options = {\n      // localVideo: this.localVideo,\n      remoteVideo: this.localVideo,\n      mediaConstraints: {\n        video: {\n          width: 640,\n          height: 480\n        },\n        audio: true\n      },\n      onicecandidate: this.onIceCandidate,\n      configuration: {\n        iceServers\n      }\n    }\n    return new Promise((resolve, reject) => {\n      this.webRtcPeer = kurentoUtils.WebRtcPeer.WebRtcPeerSendrecv(options, error => {\n        if (error) return reject(error)\n        resolve()\n      })\n    }).then(_ => {\n      this.bindEvent()\n      return new Promise((resolve, reject) => this.webRtcPeer.generateOffer((error, sdp) => {\n        if (error) return reject(error)\n        resolve(sdp)\n      }))\n    }).then(sdp => {\n      console.info('Invoking SDP offer callback function ' + location.host)\n      this.socket.emit('createPresentor', {\n        sdpOffer: sdp,\n        // 邀请某人对话\n        invite: nickname\n      })\n    })\n  }\n\n  stop = () => {\n    console.log('Stopping video call ...')\n    if (this.webRtcPeer) {\n      this.webRtcPeer.dispose()\n      this.webRtcPeer = null\n    }\n    this.localVideo.removeEventListener('canplay', this._onVideoCanplay)\n    this.socket.emit('stopPresentor')\n    this.socket.close()\n    this.emit('stop')\n  }\n\n  onIceCandidate = candidate => {\n    console.log('Local candidate' + JSON.stringify(candidate))\n\n    this.socket.emit('onIceCandidate', { candidate })\n  }\n\n  emit (name, ...args) {\n    console.log(name, this.events)\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    return cbs.map(func => func(...args))\n  }\n  on (name, cb) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    if (cbs.includes(cb)) return\n    cbs.push(cb)\n    return this\n  }\n}\n\nexport default Presentor\n"],"sourceRoot":""}