{"version":3,"sources":["webpack:///./src/views/call/accept.vue?1371","webpack:///src/views/call/accept.vue","webpack:///./src/views/call/accept.vue?54d1","webpack:///./src/views/call/accept.vue?146f","webpack:///./src/views/live/viewer.js","webpack:///./src/views/presentor/presentor.js","webpack:///./src/views/call/accept.vue?1b8d"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","type","span","_v","size","on","click","$event","$router","back","gutter","directives","name","rawName","value","expression","offset","element-loading-text","element-loading-spinner","ref","src","autoplay","poster","__webpack_require__","_s","inviter","nickname","muted","domProps","staticRenderFns","acceptvue_type_script_lang_js_presentor","acceptvue_type_script_lang_js_viewer","acceptvue_type_script_lang_js_","data","selfLoading","friendLoading","watch","$route.query","immediate","handler","originEncoded","decodeURIComponent","$route","query","JSON","parse","linkId","acceptCall","created","window","addEventListener","stopCall","mounted","beforeDestroy","removeEventListener","methods","_this","presentor","$refs","socket","emit","from","start","viewer","_","stop","call_acceptvue_type_script_lang_js_","component","Object","componentNormalizer","__webpack_exports__","Viewer","videoDom","presentorId","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_6__","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__","presentorgone","webRtcPeer","_ref","sdpAnswer","console","log","processAnswer","_ref2","candidate","addIceCandidate","pause","srcObject","load","close","options","remoteVideo","onicecandidate","onIceCandidate","configuration","iceServers","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_promise__WEBPACK_IMPORTED_MODULE_5___default","a","resolve","reject","kurentoUtils","WebRtcPeer","WebRtcPeerRecvonly","error","then","bindEvent","generateOffer","sdp","info","location","host","sdpOffer","dispose","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_4___default","io","path","token","store","state","reconnection","_onVideoCanplay","_len","arguments","length","args","Array","_key","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_object_keys__WEBPACK_IMPORTED_MODULE_1___default","events","includes","cbs","map","func","apply","cb","push","Presentor","localVideo","message","undefined","record","mediaConstraints","video","width","height","audio","WebRtcPeerSendrecv","invite","getNewSocket","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_node_modules_css_loader_index_js_ref_6_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_2_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_accept_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_node_modules_css_loader_index_js_ref_6_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_2_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_accept_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0___default","n"],"mappings":"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","file":"assets/js/chunk-4ba6bd73.a3b25065.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page-accept mx-8\"},[_c('el-row',{attrs:{\"type\":\"flex my-4\"}},[_c('el-col',{staticClass:\"flex items-center\",attrs:{\"span\":20}},[_c('h1',{staticClass:\"font-bold text-2xl\"},[_vm._v(\"正在通话\")])]),_c('el-col',{attrs:{\"span\":4}},[_c('el-button',{attrs:{\"type\":\"danger\",\"size\":\"small\"},on:{\"click\":function($event){return _vm.$router.back()}}},[_vm._v(\"挂断\")])],1)],1),_c('el-row',{staticClass:\"mx-4\",attrs:{\"gutter\":20}},[_c('el-col',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.friendLoading),expression:\"friendLoading\"}],staticClass:\"transition-all\",attrs:{\"span\":12,\"offset\":3,\"element-loading-text\":\"正在连接...\",\"element-loading-spinner\":\"el-icon-loading\"}},[_c('video',{ref:\"friend-video\",staticClass:\"w-full\",attrs:{\"src\":\"\",\"autoplay\":\"\",\"poster\":require(\"@/assets/webrtc.png\")}}),_c('p',{staticClass:\"text-center\"},[_vm._v(_vm._s(_vm.inviter.nickname))])]),_c('el-col',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.selfLoading),expression:\"selfLoading\"}],staticClass:\"transition-all\",attrs:{\"span\":6,\"element-loading-text\":\"正在连接...\",\"element-loading-spinner\":\"el-icon-loading\"}},[_c('video',{ref:\"self-video\",staticClass:\"w-full\",attrs:{\"src\":\"\",\"autoplay\":\"\",\"poster\":require(\"@/assets/webrtc.png\"),\"muted\":\"\"},domProps:{\"muted\":true}}),_c('p',{staticClass:\"text-center\"},[_vm._v(\"我\")])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"page-accept mx-8\">\n    <el-row type=\"flex my-4\">\n      <el-col :span=\"20\" class=\"flex items-center\">\n        <h1 class=\"font-bold text-2xl\">正在通话</h1>\n      </el-col>\n      <el-col :span=\"4\">\n        <el-button type=\"danger\" size=\"small\" @click=\"$router.back()\">挂断</el-button>\n      </el-col>\n    </el-row>\n    <el-row class=\"mx-4\" :gutter=\"20\">\n      <el-col :span=\"12\" v-loading=\"friendLoading\" class=\"transition-all\" :offset=\"3\"\n       element-loading-text=\"正在连接...\" element-loading-spinner=\"el-icon-loading\">\n        <video src=\"\" autoplay class=\"w-full\" ref=\"friend-video\"\n          poster=\"@/assets/webrtc.png\"\n        ></video>\n        <p class=\"text-center\">{{inviter.nickname}}</p>\n      </el-col>\n      <el-col :span=\"6\" v-loading=\"selfLoading\" class=\"transition-all\"\n        element-loading-text=\"正在连接...\" element-loading-spinner=\"el-icon-loading\">\n        <video src=\"\" autoplay class=\"w-full\" ref=\"self-video\" poster=\"@/assets/webrtc.png\" muted></video>\n        <p class=\"text-center\">我</p>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport Presentor from '../presentor/presentor'\nimport Viewer from '../live/viewer'\n\nlet presentor = null\nlet viewer = null\nexport default {\n  name: 'page-accept',\n  data () {\n    return {\n      inviter: {},\n      selfLoading: false,\n      friendLoading: false\n    }\n  },\n  watch: {\n    '$route.query': {\n      immediate: false,\n      handler () {\n        const originEncoded = decodeURIComponent(this.$route.query.inviter || '')\n        const inviter = originEncoded && JSON.parse(originEncoded)\n        const linkId = decodeURIComponent(this.$route.query.linkId || '')\n        inviter && linkId && this.acceptCall(inviter, linkId)\n      }\n    }\n  },\n  created () {\n    window.addEventListener('unload', this.stopCall)\n    this.stopCall()\n  },\n  mounted () {\n    const originEncoded = decodeURIComponent(this.$route.query.inviter || '')\n    const inviter = originEncoded && JSON.parse(originEncoded)\n    const linkId = decodeURIComponent(this.$route.query.linkId || '')\n    inviter && linkId && this.acceptCall(inviter, linkId)\n  },\n  beforeDestroy () {\n    this.stopCall()\n    window.removeEventListener('unload', this.stopCall)\n  },\n  methods: {\n    acceptCall (inviter, linkId) {\n      this.inviter = inviter\n      this.selfLoading = true\n      this.friendLoading = true\n      presentor = new Presentor(this.$refs['self-video'])\n      presentor.on('start', () => {\n        this.selfLoading = false\n        presentor.socket.emit('acceptcall', { from: inviter })\n      })\n      presentor.start(null, false)\n\n      viewer = new Viewer(this.$refs['friend-video'], linkId)\n      viewer.on('start', _ => {\n        this.friendLoading = false\n      })\n      viewer.on('presentorgone', _ => {\n        // 对方挂断\n        this.stopCall()\n        this.$router.back()\n      })\n      viewer.start()\n    },\n    stopCall () {\n      presentor && presentor.stop()\n      viewer && viewer.stop()\n    }\n  }\n}\n</script>\n\n<style>\n.transition-all {\n  transition: all .4s;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accept.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accept.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./accept.vue?vue&type=template&id=3cdc6d34&\"\nimport script from \"./accept.vue?vue&type=script&lang=js&\"\nexport * from \"./accept.vue?vue&type=script&lang=js&\"\nimport style0 from \"./accept.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import { iceServers } from '@/config/webrtc'\nimport kurentoUtils from 'kurento-utils'\nimport io from 'socket.io-client'\nimport store from '../../store'\n\nclass Viewer {\n  socket = null\n  videoDom = null\n  webRtcPeer = null\n  events = {\n    start: [],\n    stop: [],\n    presentorgone: []\n  }\n  constructor (videoDom, presentorId) {\n    console.log(videoDom)\n    this.socket = io({\n      path: '/socket.io/webrtc',\n      query: {\n        token: store.state.token,\n        presentorId\n      },\n      reconnection: false\n    })\n    this.socket.on('error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('connect_error', error => {\n      console.log('error')\n      this.emit('error', error)\n    })\n    this.videoDom = videoDom\n    videoDom.addEventListener('canplay', this._onVideoCanplay)\n  }\n  _onVideoCanplay = _ => {\n    this.emit('start')\n  }\n  bindEvent = () => {\n    const { socket, webRtcPeer } = this\n    socket.on('startResponse', ({ sdpAnswer }) => {\n      console.log('SDP answer received from server. Processing ...')\n      webRtcPeer.processAnswer(sdpAnswer)\n    })\n    socket.on('iceCandidate', ({ candidate }) => {\n      console.log('iceCandidate', candidate)\n      webRtcPeer.addIceCandidate(candidate)\n    })\n    socket.on('presentorgone', _ => {\n      this.videoDom.pause()\n      this.videoDom.srcObject = null\n      this.videoDom.load()\n      this.emit('presentorgone')\n      this.socket.close()\n      this.emit('stop')\n    })\n    console.log(webRtcPeer)\n  }\n  start = () => {\n    const options = {\n      remoteVideo: this.videoDom,\n      onicecandidate: this.onIceCandidate,\n      configuration: {\n        iceServers\n      }\n    }\n    return new Promise((resolve, reject) => {\n      this.webRtcPeer = kurentoUtils.WebRtcPeer.WebRtcPeerRecvonly(options, error => {\n        if (error) return reject(error)\n        resolve()\n      })\n    }).then(_ => {\n      this.bindEvent()\n      return new Promise((resolve, reject) => this.webRtcPeer.generateOffer((error, sdp) => {\n        if (error) return reject(error)\n        resolve(sdp)\n      }))\n    }).then(sdp => {\n      console.info('Invoking SDP offer callback function ' + location.host)\n      this.socket.emit('createViewer', {\n        sdpOffer: sdp\n      })\n    })\n  }\n\n  stop = () => {\n    console.log('Stopping viewer ...')\n    if (this.webRtcPeer) {\n      this.webRtcPeer.dispose()\n      console.log('dispose')\n      this.webRtcPeer = null\n    }\n    this.socket.emit('stopViewer')\n  }\n\n  onIceCandidate = candidate => {\n    console.log('Local candidate' + JSON.stringify(candidate))\n\n    this.socket.emit('onIceCandidate', { candidate })\n  }\n\n  emit (name, ...args) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    return cbs.map(func => func(...args))\n  }\n  on (name, cb) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    if (cbs.includes(cb)) return\n    cbs.push(cb)\n  }\n}\n\nexport default Viewer\n","import { iceServers } from '@/config/webrtc'\nimport kurentoUtils from 'kurento-utils'\nimport { getNewSocket } from '@/socket'\n\nclass Presentor {\n  socket = null\n  localVideo = null\n  webRtcPeer = null\n  events = {\n    start: [],\n    stop: [],\n    error: [],\n    message: []\n  }\n  constructor (localVideo) {\n    this.socket = getNewSocket()\n    console.log(this.socket)\n    this.socket.on('error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('connect_error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('callaccepted', message => {\n      this.emit('callaccepted', message)\n    })\n    this.socket.on('callrejected', message => {\n      this.emit('callrejected', message)\n    })\n    this.socket.on('callerror', error => {\n      this.emit('callerror', error)\n    })\n    this.socket.on('message', message => {\n      this.emit('message', message)\n    })\n    this.localVideo = localVideo\n    localVideo.addEventListener('canplay', this._onVideoCanplay)\n  }\n  _onVideoCanplay = _ => {\n    console.log('onvideocanplay')\n    this.emit('start')\n  }\n  bindEvent = () => {\n    const { socket, webRtcPeer } = this\n    socket.on('startResponse', ({ sdpAnswer }) => {\n      console.log('SDP answer received from server. Processing ...')\n      webRtcPeer.processAnswer(sdpAnswer)\n    })\n    socket.on('iceCandidate', ({ candidate }) => {\n      webRtcPeer.addIceCandidate(candidate)\n    })\n  }\n  start = (nickname = null, record = true) => {\n    const options = {\n      // localVideo: this.localVideo,\n      remoteVideo: this.localVideo,\n      mediaConstraints: {\n        video: {\n          width: 640,\n          height: 480\n        },\n        audio: true\n      },\n      onicecandidate: this.onIceCandidate,\n      configuration: {\n        iceServers\n      }\n    }\n    return new Promise((resolve, reject) => {\n      this.webRtcPeer = kurentoUtils.WebRtcPeer.WebRtcPeerSendrecv(options, error => {\n        if (error) return reject(error)\n        resolve()\n      })\n    }).then(_ => {\n      this.bindEvent()\n      return new Promise((resolve, reject) => this.webRtcPeer.generateOffer((error, sdp) => {\n        if (error) return reject(error)\n        resolve(sdp)\n      }))\n    }).then(sdp => {\n      console.info('Invoking SDP offer callback function ' + location.host)\n      this.socket.emit('createPresentor', {\n        sdpOffer: sdp,\n        // 邀请某人对话\n        invite: nickname,\n        record\n      })\n    })\n  }\n\n  stop = () => {\n    console.log('Stopping video call ...')\n    if (this.webRtcPeer) {\n      this.webRtcPeer.dispose()\n      this.webRtcPeer = null\n    }\n    this.localVideo.removeEventListener('canplay', this._onVideoCanplay)\n    this.socket.emit('stopPresentor')\n    this.socket.close()\n    this.emit('stop')\n  }\n\n  onIceCandidate = candidate => {\n    console.log('Local candidate' + JSON.stringify(candidate))\n\n    this.socket.emit('onIceCandidate', { candidate })\n  }\n\n  emit (name, ...args) {\n    console.log(name, this.events)\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    return cbs.map(func => func(...args))\n  }\n  on (name, cb) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    if (cbs.includes(cb)) return\n    cbs.push(cb)\n    return this\n  }\n}\n\nexport default Presentor\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accept.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accept.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}