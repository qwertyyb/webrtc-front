{"version":3,"sources":["webpack:///./src/views/call/index.vue?8010","webpack:///src/views/call/index.vue","webpack:///./src/views/call/index.vue?31e5","webpack:///./src/views/call/index.vue?b0a8","webpack:///./src/views/live/viewer.js","webpack:///./src/views/call/index.vue?1f36","webpack:///./src/views/presentor/presentor.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","type","justify","align","span","_v","size","model","value","friend","callback","$$v","$set","expression","disabled","status","on","click","askACall","_s","stopACall","gutter","hidden","offset","ref","src","autoplay","poster","__webpack_require__","nickname","id","muted","domProps","staticRenderFns","callvue_type_script_lang_js_presentor","callvue_type_script_lang_js_viewer","callvue_type_script_lang_js_","name","data","created","window","addEventListener","mounted","console","log","beforeDestroy","removeEventListener","methods","trim","presentor","$refs","onCallerror","start","bindEvents","$message","warning","offEvents","stop","socket","Object","src_socket","once","onCallaccepted","onCallrejected","off","_ref","to","element_ui_common","title","concat","_ref2","_this","linkId","success","message","viewer","_","_ref3","error","views_callvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__","Viewer","videoDom","presentorId","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_6__","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__","presentorgone","emit","webRtcPeer","sdpAnswer","processAnswer","candidate","addIceCandidate","pause","srcObject","load","close","options","remoteVideo","onicecandidate","onIceCandidate","configuration","iceServers","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_promise__WEBPACK_IMPORTED_MODULE_5___default","a","resolve","reject","kurentoUtils","WebRtcPeer","WebRtcPeerRecvonly","then","bindEvent","generateOffer","sdp","info","location","host","sdpOffer","dispose","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_4___default","io","path","query","token","store","state","reconnection","_onVideoCanplay","_len","arguments","length","args","Array","_key","_Users_qwertyyb_projects_webrtc_frontend_node_modules_babel_runtime_corejs2_core_js_object_keys__WEBPACK_IMPORTED_MODULE_1___default","events","includes","cbs","map","func","apply","cb","push","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_node_modules_css_loader_index_js_ref_6_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_2_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_node_modules_css_loader_index_js_ref_6_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_2_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0___default","n","Presentor","localVideo","undefined","record","mediaConstraints","video","width","height","audio","WebRtcPeerSendrecv","invite","getNewSocket"],"mappings":"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","file":"assets/js/chunk-557e7b22.dc9a87a9.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"mx-4\"},[_c('el-row',{attrs:{\"type\":\"flex\",\"justify\":\"center\",\"align\":\"middle\"}},[_c('el-col',{staticClass:\"text-right\",attrs:{\"span\":8}},[_vm._v(\"\\n      请输入对方的用户名：\\n    \")]),_c('el-col',{attrs:{\"span\":8}},[_c('el-input',{attrs:{\"size\":\"small\"},model:{value:(_vm.friend.nickname),callback:function ($$v) {_vm.$set(_vm.friend, \"nickname\", $$v)},expression:\"friend.nickname\"}})],1),_c('el-col',{staticClass:\"ml-2\",attrs:{\"span\":8}},[_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"primary\",\"disabled\":_vm.status!='free'},on:{\"click\":_vm.askACall}},[_vm._v(_vm._s(_vm.status == 'free' ? '呼叫' : '正在呼叫...'))]),_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"danger\",\"disabled\":_vm.status=='free'},on:{\"click\":_vm.stopACall}},[_vm._v(\"挂断\")])],1)],1),_c('el-row',{staticClass:\"mt-4\",attrs:{\"gutter\":10,\"hidden\":_vm.status === 'free'}},[_c('el-col',{staticClass:\"transition-all\",attrs:{\"span\":12,\"offset\":3,\"hidden\":_vm.status==='linking'}},[_c('video',{ref:\"friend-video\",staticClass:\"m-2 friend-video border\",attrs:{\"src\":\"\",\"autoplay\":\"\",\"poster\":require(\"@/assets/webrtc.png\")}}),_c('p',{staticClass:\"text-center\"},[_vm._v(_vm._s(_vm.friend.nickname))])]),_c('el-col',{staticClass:\"transition-all\",attrs:{\"span\":_vm.status==='linking'? 12 : 6,\"offset\":_vm.status==='linking' ? 6 : 0}},[_c('video',{ref:\"self-video\",staticClass:\"w-full m-2 border\",attrs:{\"src\":\"\",\"id\":\"self-video\",\"autoplay\":\"\",\"poster\":require(\"@/assets/webrtc.png\"),\"muted\":\"\"},domProps:{\"muted\":true}}),_c('p',{staticClass:\"text-center\"},[_vm._v(\"我\")])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"mx-4\">\n    <el-row type=\"flex\" justify=\"center\" align=\"middle\">\n      <el-col :span=\"8\" class=\"text-right\">\n        请输入对方的用户名：\n      </el-col>\n      <el-col :span=\"8\">\n        <el-input size=\"small\" v-model=\"friend.nickname\"></el-input>\n      </el-col>\n      <el-col :span=\"8\" class=\"ml-2\">\n        <el-button size=\"small\" type=\"primary\"\n          @click=\"askACall\" :disabled=\"status!='free'\"\n        >{{status == 'free' ? '呼叫' : '正在呼叫...'}}</el-button>\n        <el-button size=\"small\" type=\"danger\" :disabled=\"status=='free'\"\n          @click=\"stopACall\"\n        >挂断</el-button>\n      </el-col>\n    </el-row>\n    <el-row :gutter=\"10\" :hidden=\"status === 'free'\" class=\"mt-4\">\n      <el-col :span=\"12\" :offset=\"3\" :hidden=\"status==='linking'\" class=\"transition-all\">\n        <video src=\"\" class=\"m-2 friend-video border\" ref=\"friend-video\" autoplay\n          poster=\"@/assets/webrtc.png\"\n        ></video>\n        <p class=\"text-center\">{{friend.nickname}}</p>\n      </el-col>\n      <el-col :span=\"status==='linking'? 12 : 6\" :offset=\"status==='linking' ? 6 : 0\" class=\"transition-all\">\n        <video src=\"\" class=\"w-full m-2 border\" id=\"self-video\" ref=\"self-video\" autoplay\n          poster=\"@/assets/webrtc.png\"\n          muted\n        ></video>\n        <p class=\"text-center\">我</p>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport { Notification } from 'element-ui'\nimport Presentor from '../presentor/presentor'\nimport Viewer from '../live/viewer'\nimport { getGlobalSocket } from '@/socket'\n\nlet presentor = null\nlet viewer = null\nexport default {\n  name: 'page-call',\n  data () {\n    return {\n      friend: {\n        nickname: ''\n      },\n      status: 'free'\n    }\n  },\n  created () {\n    window.addEventListener('unload', this.stopACall)\n  },\n  mounted () {\n    console.log(this)\n  },\n  beforeDestroy () {\n    this.stopACall()\n    window.removeEventListener('unload', this.stopACall)\n  },\n  methods: {\n    askACall () {\n      const { nickname } = this.friend\n      if (!nickname || !nickname.trim()) {\n        this.$message.warning('请输入对方用户名')\n        return\n      }\n      this.stopACall()\n      presentor = new Presentor(this.$refs['self-video'])\n      presentor.on('error', this.onCallerror)\n      presentor.start(nickname.trim(), false)\n      this.status = 'linking'\n      this.bindEvents()\n    },\n    stopACall () {\n      this.offEvents()\n      presentor && presentor.stop()\n      viewer && viewer.stop()\n      this.status = 'free'\n    },\n    bindEvents () {\n      const socket = getGlobalSocket()\n      socket.once('callaccepted', this.onCallaccepted)\n      socket.once('callrejected', this.onCallrejected)\n      socket.on('callerror', this.onCallerror)\n    },\n    offEvents () {\n      const socket = getGlobalSocket()\n      socket.off('callaccepted', this.onCallaccepted)\n      socket.off('callrejected', this.onCallrejected)\n      socket.off('callerror', this.onCallerror)\n    },\n    onCallrejected ({ to }) {\n      this.stopACall()\n      this.status = 'free'\n      Notification.warning({\n        title: `呼叫已被${to.nickname}拒绝`\n      })\n    },\n    onCallaccepted ({ to, linkId }) {\n      console.log(`呼叫已被${to.nickname}接听`)\n      this.status = 'calling'\n      Notification.success({\n        title: `呼叫已被${to.nickname}接听`,\n        message: '正在建立连接...'\n      })\n      viewer = new Viewer(this.$refs['friend-video'], linkId)\n      viewer.on('presentorgone', _ => {\n        this.stopACall()\n      })\n      viewer.start()\n    },\n    onCallerror ({ message }) {\n      this.stopACall()\n      Notification.error({\n        title: message\n      })\n      this.status = 'free'\n    }\n  }\n}\n</script>\n\n<style>\n.transition-all {\n  transition: all .4s;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=fdaa903e&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import { iceServers } from '@/config/webrtc'\nimport kurentoUtils from 'kurento-utils'\nimport io from 'socket.io-client'\nimport store from '../../store'\n\nclass Viewer {\n  socket = null\n  videoDom = null\n  webRtcPeer = null\n  events = {\n    start: [],\n    stop: [],\n    presentorgone: []\n  }\n  constructor (videoDom, presentorId) {\n    console.log(videoDom)\n    this.socket = io({\n      path: '/socket.io/webrtc',\n      query: {\n        token: store.state.token,\n        presentorId\n      },\n      reconnection: false\n    })\n    this.socket.on('error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('connect_error', error => {\n      console.log('error')\n      this.emit('error', error)\n    })\n    this.videoDom = videoDom\n    videoDom.addEventListener('canplay', this._onVideoCanplay)\n  }\n  _onVideoCanplay = _ => {\n    this.emit('start')\n  }\n  bindEvent = () => {\n    const { socket, webRtcPeer } = this\n    socket.on('startResponse', ({ sdpAnswer }) => {\n      console.log('SDP answer received from server. Processing ...')\n      webRtcPeer.processAnswer(sdpAnswer)\n    })\n    socket.on('iceCandidate', ({ candidate }) => {\n      console.log('iceCandidate', candidate)\n      webRtcPeer.addIceCandidate(candidate)\n    })\n    socket.on('presentorgone', _ => {\n      this.videoDom.pause()\n      this.videoDom.srcObject = null\n      this.videoDom.load()\n      this.emit('presentorgone')\n      this.socket.close()\n      this.emit('stop')\n    })\n    console.log(webRtcPeer)\n  }\n  start = () => {\n    const options = {\n      remoteVideo: this.videoDom,\n      onicecandidate: this.onIceCandidate,\n      configuration: {\n        iceServers\n      }\n    }\n    return new Promise((resolve, reject) => {\n      this.webRtcPeer = kurentoUtils.WebRtcPeer.WebRtcPeerRecvonly(options, error => {\n        if (error) return reject(error)\n        resolve()\n      })\n    }).then(_ => {\n      this.bindEvent()\n      return new Promise((resolve, reject) => this.webRtcPeer.generateOffer((error, sdp) => {\n        if (error) return reject(error)\n        resolve(sdp)\n      }))\n    }).then(sdp => {\n      console.info('Invoking SDP offer callback function ' + location.host)\n      this.socket.emit('createViewer', {\n        sdpOffer: sdp\n      })\n    })\n  }\n\n  stop = () => {\n    console.log('Stopping viewer ...')\n    if (this.webRtcPeer) {\n      this.webRtcPeer.dispose()\n      console.log('dispose')\n      this.webRtcPeer = null\n    }\n    this.socket.emit('stopViewer')\n  }\n\n  onIceCandidate = candidate => {\n    console.log('Local candidate' + JSON.stringify(candidate))\n\n    this.socket.emit('onIceCandidate', { candidate })\n  }\n\n  emit (name, ...args) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    return cbs.map(func => func(...args))\n  }\n  on (name, cb) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    if (cbs.includes(cb)) return\n    cbs.push(cb)\n  }\n}\n\nexport default Viewer\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=css&\"","import { iceServers } from '@/config/webrtc'\nimport kurentoUtils from 'kurento-utils'\nimport { getNewSocket } from '@/socket'\n\nclass Presentor {\n  socket = null\n  localVideo = null\n  webRtcPeer = null\n  events = {\n    start: [],\n    stop: [],\n    error: [],\n    message: []\n  }\n  constructor (localVideo) {\n    this.socket = getNewSocket()\n    console.log(this.socket)\n    this.socket.on('error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('connect_error', error => {\n      this.emit('error', error)\n    })\n    this.socket.on('callaccepted', message => {\n      this.emit('callaccepted', message)\n    })\n    this.socket.on('callrejected', message => {\n      this.emit('callrejected', message)\n    })\n    this.socket.on('callerror', error => {\n      this.emit('callerror', error)\n    })\n    this.socket.on('message', message => {\n      this.emit('message', message)\n    })\n    this.localVideo = localVideo\n    localVideo.addEventListener('canplay', this._onVideoCanplay)\n  }\n  _onVideoCanplay = _ => {\n    console.log('onvideocanplay')\n    this.emit('start')\n  }\n  bindEvent = () => {\n    const { socket, webRtcPeer } = this\n    socket.on('startResponse', ({ sdpAnswer }) => {\n      console.log('SDP answer received from server. Processing ...')\n      webRtcPeer.processAnswer(sdpAnswer)\n    })\n    socket.on('iceCandidate', ({ candidate }) => {\n      webRtcPeer.addIceCandidate(candidate)\n    })\n  }\n  start = (nickname = null, record = true) => {\n    const options = {\n      // localVideo: this.localVideo,\n      remoteVideo: this.localVideo,\n      mediaConstraints: {\n        video: {\n          width: 640,\n          height: 480\n        },\n        audio: true\n      },\n      onicecandidate: this.onIceCandidate,\n      configuration: {\n        iceServers\n      }\n    }\n    return new Promise((resolve, reject) => {\n      this.webRtcPeer = kurentoUtils.WebRtcPeer.WebRtcPeerSendrecv(options, error => {\n        if (error) return reject(error)\n        resolve()\n      })\n    }).then(_ => {\n      this.bindEvent()\n      return new Promise((resolve, reject) => this.webRtcPeer.generateOffer((error, sdp) => {\n        if (error) return reject(error)\n        resolve(sdp)\n      }))\n    }).then(sdp => {\n      console.info('Invoking SDP offer callback function ' + location.host)\n      this.socket.emit('createPresentor', {\n        sdpOffer: sdp,\n        // 邀请某人对话\n        invite: nickname,\n        record\n      })\n    })\n  }\n\n  stop = () => {\n    console.log('Stopping video call ...')\n    if (this.webRtcPeer) {\n      this.webRtcPeer.dispose()\n      this.webRtcPeer = null\n    }\n    this.localVideo.removeEventListener('canplay', this._onVideoCanplay)\n    this.socket.emit('stopPresentor')\n    this.socket.close()\n    this.emit('stop')\n  }\n\n  onIceCandidate = candidate => {\n    console.log('Local candidate' + JSON.stringify(candidate))\n\n    this.socket.emit('onIceCandidate', { candidate })\n  }\n\n  emit (name, ...args) {\n    console.log(name, this.events)\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    return cbs.map(func => func(...args))\n  }\n  on (name, cb) {\n    if (!Object.keys(this.events).includes(name)) return\n    const cbs = this.events[name]\n    if (cbs.includes(cb)) return\n    cbs.push(cb)\n    return this\n  }\n}\n\nexport default Presentor\n"],"sourceRoot":""}