(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e05e933"],{1728:function(e,t,s){"use strict";var n=s("c46b"),i=s.n(n);i.a},"30ec":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-live flex justify-center"},[n("div",{staticClass:"container-video flex justify-center flex-col items-center bg-black p-2 relative"},[n("video",{ref:"video",staticClass:"video w-full",attrs:{src:e.src,autoplay:"",poster:s("b8b5")}}),n("div",{staticClass:"living-controls-wrapper mt-2 flex w-full items-center"},[n("span",{staticClass:"text-white mr-auto"},[e._v("状态: "+e._s(e.statusText))]),"initial"==e.status?n("el-button",{attrs:{type:"primary"},on:{click:e.start}},[e._v("开始直播")]):"starting"!=e.status?n("el-button",{staticClass:"ml-3",attrs:{type:"danger"},on:{click:e.stop}},[e._v("停止直播")]):e._e()],1)]),n("div",{staticClass:"container-message w-64 rounded ml-4 flex flex-col justify-between bg-gray-200"},[n("div",{staticClass:"wrapper-messages bg-gray-100 border p-2 overflow-y-auto"},[e._l(e.messages,function(t){return["start"==t.type?n("div",{key:t.id,staticClass:"message-item flex justify-center py-1 items-center mb-2 text-sm bg-gray-500 text-center rounded-full"},[n("span",{staticClass:"font-bold mr-1 text-yellow-300"},[e._v("直播已开始")])]):e._e(),"viewer-entry"==t.type?n("div",{key:t.id,staticClass:"message-item flex justify-center py-1 items-center mb-2 text-sm bg-gray-500 text-center rounded-full"},[n("span",[e._v(e._s(t.time))]),n("img",{staticClass:"w-6 mx-1 rounded-full",attrs:{src:t.from.avatar,alt:""}}),n("span",{staticClass:"font-bold mr-1 text-blue-600"},[e._v(e._s(t.from.nickname))]),e._m(0,!0)]):e._e(),"viewer-leave"==t.type?n("div",{key:t.id,staticClass:"message-item flex justify-center py-1 items-center mb-2 text-sm bg-red-300 text-center rounded-full"},[n("span",[e._v(e._s(t.time))]),n("img",{staticClass:"w-6 mx-1 rounded-full",attrs:{src:t.from.avatar,alt:""}}),n("span",{staticClass:"font-bold mr-1 text-blue-900"},[e._v(e._s(t.from.nickname))]),e._m(1,!0)]):e._e(),"stop"==t.type?n("div",{key:t.id,staticClass:"message-item flex justify-center py-1 items-center mb-2 text-sm bg-red-600 text-center rounded-full"},[n("span",{staticClass:"font-bold mr-1 text-blue-900"},[e._v("直播已结束")])]):e._e()]})],2),e._e()])])},i=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",[e._v("已 "),s("b",[e._v("进入")]),e._v(" 直播间")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",[e._v("已 "),s("b",[e._v("离开")]),e._v(" 直播间")])}],a=s("d5db"),o=null,r={name:"page-presentor",data:function(){return{src:null,status:"initial",messages:[]}},computed:{statusText:function(){var e={initial:"未开始",starting:"准备中",living:"直播中",ending:"结束中",ended:"已结束"};return e[this.status]}},created:function(){var e=this;window.addEventListener("unload",function(){e.stop()})},beforeDestroy:function(){console.log("before destroy"),this.stop()},methods:{start:function(){var e=this;this.status="starting",o=new a["a"](this.$refs.video),console.log(o),o.on("start",function(){e.status="living",e.messages.push({type:"start"})}),o.on("error",function(t){console.log(t),e.stop()}),o.on("message",function(t){console.log("received message:",t),e.messages.push(t)}),o.start()},stop:function(){o&&o.stop(),o=null,this.status="initial",this.messages.push({type:"stop"})}}},c=r,l=(s("1728"),s("2877")),u=Object(l["a"])(c,n,i,!1,null,"6976eee4",null);t["default"]=u.exports},c46b:function(e,t,s){},d5db:function(e,t,s){"use strict";s("7f7f");var n=s("a4bb"),i=s.n(n),a=(s("6762"),s("2fdb"),s("f499")),o=s.n(a),r=s("795b"),c=s.n(r),l=s("d225"),u=s("b0b4"),d=s("bd86"),f=s("a825"),v=s("d519"),m=s.n(v),p=s("6c23"),b=function(){function e(t){var s=this;Object(l["a"])(this,e),Object(d["a"])(this,"socket",null),Object(d["a"])(this,"localVideo",null),Object(d["a"])(this,"webRtcPeer",null),Object(d["a"])(this,"events",{start:[],stop:[],error:[],message:[]}),Object(d["a"])(this,"_onVideoCanplay",function(e){console.log("onvideocanplay"),s.emit("start")}),Object(d["a"])(this,"bindEvent",function(){var e=s.socket,t=s.webRtcPeer;e.on("startResponse",function(e){var s=e.sdpAnswer;console.log("SDP answer received from server. Processing ..."),t.processAnswer(s)}),e.on("iceCandidate",function(e){var s=e.candidate;t.addIceCandidate(s)})}),Object(d["a"])(this,"start",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={remoteVideo:s.localVideo,mediaConstraints:{video:{width:640,height:480},audio:!0},onicecandidate:s.onIceCandidate,configuration:{iceServers:f["a"]}};return new c.a(function(e,t){s.webRtcPeer=m.a.WebRtcPeer.WebRtcPeerSendrecv(n,function(s){if(s)return t(s);e()})}).then(function(e){return s.bindEvent(),new c.a(function(e,t){return s.webRtcPeer.generateOffer(function(s,n){if(s)return t(s);e(n)})})}).then(function(n){console.info("Invoking SDP offer callback function "+location.host),s.socket.emit("createPresentor",{sdpOffer:n,invite:e,record:t})})}),Object(d["a"])(this,"stop",function(){console.log("Stopping video call ..."),s.webRtcPeer&&(s.webRtcPeer.dispose(),s.webRtcPeer=null),s.localVideo.removeEventListener("canplay",s._onVideoCanplay),s.socket.emit("stopPresentor"),s.socket.close(),s.emit("stop")}),Object(d["a"])(this,"onIceCandidate",function(e){console.log("Local candidate"+o()(e)),s.socket.emit("onIceCandidate",{candidate:e})}),this.socket=Object(p["b"])(),console.log(this.socket),this.socket.on("error",function(e){s.emit("error",e)}),this.socket.on("connect_error",function(e){s.emit("error",e)}),this.socket.on("callaccepted",function(e){s.emit("callaccepted",e)}),this.socket.on("callrejected",function(e){s.emit("callrejected",e)}),this.socket.on("callerror",function(e){s.emit("callerror",e)}),this.socket.on("message",function(e){s.emit("message",e)}),this.localVideo=t,t.addEventListener("canplay",this._onVideoCanplay)}return Object(u["a"])(e,[{key:"emit",value:function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];if(console.log(e,this.events),i()(this.events).includes(e)){var a=this.events[e];return a.map(function(e){return e.apply(void 0,s)})}}},{key:"on",value:function(e,t){if(i()(this.events).includes(e)){var s=this.events[e];if(!s.includes(t))return s.push(t),this}}}]),e}();t["a"]=b}}]);
//# sourceMappingURL=chunk-5e05e933.c4756038.js.map