(window['webpackJsonp'] = window['webpackJsonp'] || []).push([['chunk-64b87ff6'], { '30ec': function (t, e, n) { 'use strict'; n.r(e); var i = function () { var t = this; var e = t.$createElement; var i = t._self._c || e; return i('div', { staticClass: 'page-live flex justify-center' }, [i('div', { staticClass: 'container-video flex justify-center flex-col items-center bg-black p-2 relative' }, [i('video', { ref: 'video', staticClass: 'video w-full', attrs: { src: t.src, autoplay: '', poster: n('b8b5') } }), i('div', { staticClass: 'living-controls-wrapper mt-2 flex w-full items-center' }, [i('span', { staticClass: 'text-white mr-auto' }, [t._v('状态: ' + t._s(t.statusText))]), t.status == 'initial' ? i('el-button', { attrs: { type: 'primary' }, on: { click: t.start } }, [t._v('开始直播')]) : t.status != 'starting' ? i('el-button', { staticClass: 'ml-3', attrs: { type: 'danger' }, on: { click: t.stop } }, [t._v('停止直播')]) : t._e()], 1)]), t._m(0)]) }; var s = [function () { var t = this; var e = t.$createElement; var n = t._self._c || e; return n('div', { staticClass: 'container-message w-64 ml-4 flex flex-col justify-between' }, [n('div', { staticClass: 'wrapper-message' }, [t._v('\n      这是消息内容\n    ')]), n('div', { staticClass: 'wrapper-input' }, [n('input', { staticClass: 'border h-8 rounded', attrs: { type: 'text' } }), n('button', { staticClass: 'bg-blue h-full px-2 text-white hover:bg-blue-light rounded ml-2' }, [t._v('发送')])])]) }]; var o = n('d5db'); var c = null; var a = { name: 'page-presentor', data: function () { return { src: null, status: 'initial' } }, computed: { statusText: function () { var t = { initial: '未开始', starting: '准备中', living: '直播中', ending: '结束中', ended: '已结束' }; return t[this.status] } }, created: function () { var t = this; window.addEventListener('unload', function () { t.stop() }) }, beforeDestroy: function () { console.log('before destroy'), this.stop() }, methods: { start: function () { var t = this; this.status = 'starting', c = new o['a'](this.$refs.video), console.log(c), c.on('start', function () { t.status = 'living' }), c.on('error', function (e) { console.log(e), t.stop() }), c.start() }, stop: function () { c && c.stop(), c = null, this.status = 'initial' } } }; var r = a; var l = (n('7001'), n('2877')); var u = Object(l['a'])(r, i, s, !1, null, '5ff92d1c', null); e['default'] = u.exports }, 7001: function (t, e, n) { 'use strict'; var i = n('77fc'); var s = n.n(i); s.a }, '77fc': function (t, e, n) {}, d5db: function (t, e, n) { 'use strict'; n('7f7f'); var i = n('a4bb'); var s = n.n(i); var o = (n('6762'), n('2fdb'), n('f499')); var c = n.n(o); var a = n('795b'); var r = n.n(a); var l = n('d225'); var u = n('b0b4'); var d = n('bd86'); var f = n('a825'); var v = n('d519'); var p = n.n(v); var b = n('6c23'); var h = (function () { function t (e) { var n = this; Object(l['a'])(this, t), Object(d['a'])(this, 'socket', null), Object(d['a'])(this, 'localVideo', null), Object(d['a'])(this, 'webRtcPeer', null), Object(d['a'])(this, 'events', { start: [], stop: [], error: [], callaccepted: [], callrejected: [], callerror: [] }), Object(d['a'])(this, '_onVideoCanplay', function (t) { console.log('onvideocanplay'), n.emit('start') }), Object(d['a'])(this, 'bindEvent', function () { var t = n.socket; var e = n.webRtcPeer; t.on('startResponse', function (t) { var n = t.sdpAnswer; console.log('SDP answer received from server. Processing ...'), e.processAnswer(n) }), t.on('iceCandidate', function (t) { var n = t.candidate; e.addIceCandidate(n) }) }), Object(d['a'])(this, 'start', function () { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : null; var e = { remoteVideo: n.localVideo, mediaConstraints: { video: { width: 640, height: 480 }, audio: !0 }, onicecandidate: n.onIceCandidate, configuration: { iceServers: f['a'] } }; return new r.a(function (t, i) { n.webRtcPeer = p.a.WebRtcPeer.WebRtcPeerSendrecv(e, function (e) { if (e) return i(e); t() }) }).then(function (t) { return n.bindEvent(), new r.a(function (t, e) { return n.webRtcPeer.generateOffer(function (n, i) { if (n) return e(n); t(i) }) }) }).then(function (e) { console.info('Invoking SDP offer callback function ' + location.host), n.socket.emit('createPresentor', { sdpOffer: e, invite: t }) }) }), Object(d['a'])(this, 'stop', function () { console.log('Stopping video call ...'), n.webRtcPeer && (n.webRtcPeer.dispose(), n.webRtcPeer = null), n.localVideo.removeEventListener('canplay', n._onVideoCanplay), n.socket.emit('stop'), n.socket.close(), n.emit('stop') }), Object(d['a'])(this, 'onIceCandidate', function (t) { console.log('Local candidate' + c()(t)), n.socket.emit('onIceCandidate', { candidate: t }) }), this.socket = Object(b['b'])(), console.log(this.socket), this.socket.on('error', function (t) { n.emit('error', t) }), this.socket.on('connect_error', function (t) { n.emit('error', t) }), this.socket.on('callaccepted', function (t) { n.emit('callaccepted', t) }), this.socket.on('callrejected', function (t) { n.emit('callrejected', t) }), this.socket.on('callerror', function (t) { n.emit('callerror', t) }), this.localVideo = e, e.addEventListener('canplay', this._onVideoCanplay) } return Object(u['a'])(t, [{ key: 'emit', value: function (t) { for (var e = arguments.length, n = new Array(e > 1 ? e - 1 : 0), i = 1; i < e; i++)n[i - 1] = arguments[i]; if (console.log(t, this.events), s()(this.events).includes(t)) { var o = this.events[t]; return o.map(function (t) { return t.apply(void 0, n) }) } } }, { key: 'on', value: function (t, e) { if (s()(this.events).includes(t)) { var n = this.events[t]; if (!n.includes(e)) return n.push(e), this } } }]), t }()); e['a'] = h } }])
// # sourceMappingURL=chunk-64b87ff6.202c4b54.js.map
