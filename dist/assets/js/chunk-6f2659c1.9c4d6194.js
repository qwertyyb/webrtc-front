(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f2659c1"],{1502:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"page-live flex justify-center"},[o("div",{staticClass:"container-video flex justify-center flex-col p-2 items-center bg-black relative"},[o("video",{ref:"video",staticClass:"video w-full m-2",attrs:{src:e.src,autoplay:"",poster:n("b8b5")}}),o("div",{staticClass:"living-controls-wrapper m-1 pl-2 flex w-full items-center"},[o("span",{staticClass:"text-white mr-auto"},[e._v("状态: "+e._s(e.statusText))])])]),e._e()])},i=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"wrapper-input"},[n("input",{staticClass:"border h-8 rounded",attrs:{type:"text"}}),n("button",{staticClass:"bg-blue h-full px-2 text-white hover:bg-blue-light rounded ml-2"},[e._v("发送")])])}],s=n("4777"),r=null,a={name:"page-live",data:function(){return{src:null,status:"initial"}},computed:{statusText:function(){var e={initial:"未开始",starting:"准备中",living:"直播中",ending:"结束中",ended:"已结束"};return e[this.status]}},created:function(){var e=this;window.addEventListener("unload",function(){e.stop()})},mounted:function(){this.start()},beforeDestroy:function(){console.log("before destroy"),this.stop()},methods:{start:function(){var e=this;this.status="starting",r=new s["a"](this.$refs.video,this.$route.params.liveId),console.log(r),r.on("start",function(){e.status="living"}),r.start()},stop:function(){r&&r.stop(),r=null,this.status="initial"}}},c=a,l=(n("91ee"),n("2877")),u=Object(l["a"])(c,o,i,!1,null,"a6d306f4",null);t["default"]=u.exports},"24ca":function(e,t,n){},4777:function(e,t,n){"use strict";n("7f7f");var o=n("a4bb"),i=n.n(o),s=(n("6762"),n("2fdb"),n("f499")),r=n.n(s),a=n("795b"),c=n.n(a),l=n("d225"),u=n("b0b4"),d=n("bd86"),f=n("a825"),v=n("d519"),p=n.n(v),b=n("8055"),h=n.n(b),w=n("c0d6"),g=function(){function e(t,n){var o=this;Object(l["a"])(this,e),Object(d["a"])(this,"socket",null),Object(d["a"])(this,"videoDom",null),Object(d["a"])(this,"webRtcPeer",null),Object(d["a"])(this,"events",{start:[],stop:[],presentorgone:[]}),Object(d["a"])(this,"_onVideoCanplay",function(e){o.emit("start")}),Object(d["a"])(this,"bindEvent",function(){var e=o.socket,t=o.webRtcPeer;e.on("startResponse",function(e){var n=e.sdpAnswer;console.log("SDP answer received from server. Processing ..."),t.processAnswer(n)}),e.on("iceCandidate",function(e){var n=e.candidate;console.log("iceCandidate",n),t.addIceCandidate(n)}),e.on("presentorgone",function(e){o.videoDom.pause(),o.videoDom.srcObject=null,o.videoDom.load(),o.emit("presentorgone"),o.socket.close(),o.emit("stop")}),console.log(t)}),Object(d["a"])(this,"start",function(){var e={remoteVideo:o.videoDom,onicecandidate:o.onIceCandidate,configuration:{iceServers:f["a"]}};return new c.a(function(t,n){o.webRtcPeer=p.a.WebRtcPeer.WebRtcPeerRecvonly(e,function(e){if(e)return n(e);t()})}).then(function(e){return o.bindEvent(),new c.a(function(e,t){return o.webRtcPeer.generateOffer(function(n,o){if(n)return t(n);e(o)})})}).then(function(e){console.info("Invoking SDP offer callback function "+location.host),o.socket.emit("createViewer",{sdpOffer:e})})}),Object(d["a"])(this,"stop",function(){console.log("Stopping viewer ..."),o.webRtcPeer&&(o.webRtcPeer.dispose(),console.log("dispose"),o.webRtcPeer=null),o.socket.emit("stopViewer")}),Object(d["a"])(this,"onIceCandidate",function(e){console.log("Local candidate"+r()(e)),o.socket.emit("onIceCandidate",{candidate:e})}),console.log(t),this.socket=h()({path:"/socket.io/webrtc",query:{token:w["a"].state.token,presentorId:n},reconnection:!1}),this.socket.on("error",function(e){o.emit("error",e)}),this.socket.on("connect_error",function(e){console.log("error"),o.emit("error",e)}),this.videoDom=t,t.addEventListener("canplay",this._onVideoCanplay)}return Object(u["a"])(e,[{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(i()(this.events).includes(e)){var s=this.events[e];return s.map(function(e){return e.apply(void 0,n)})}}},{key:"on",value:function(e,t){if(i()(this.events).includes(e)){var n=this.events[e];n.includes(t)||n.push(t)}}}]),e}();t["a"]=g},"91ee":function(e,t,n){"use strict";var o=n("24ca"),i=n.n(o);i.a}}]);
//# sourceMappingURL=chunk-6f2659c1.9c4d6194.js.map